<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watchlist | ELUXRAJ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root{--bg:#0a0a0f;--card:#1a1a24;--purple:#7c3aed;--cyan:#06b6d4;--green:#10b981;--red:#ef4444;--white:#fff;--gray400:#9ca3af;--gray500:#6b7280}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--white);min-height:100vh}
        .header{display:flex;justify-content:space-between;align-items:center;padding:16px 32px;border-bottom:1px solid rgba(124,58,237,0.2)}
        .logo{font-size:1.25rem;font-weight:900;background:linear-gradient(135deg,var(--purple),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none}
        .nav{display:flex;gap:24px;align-items:center}
        .nav a{color:var(--gray400);text-decoration:none;font-size:.9rem}
        .nav a:hover{color:var(--white)}
        .container{max-width:1000px;margin:0 auto;padding:40px 20px}
        .page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px}
        .page-header h1{font-size:1.75rem}
        .add-btn{background:linear-gradient(135deg,var(--purple),var(--cyan));color:var(--white);border:none;padding:12px 24px;border-radius:10px;font-weight:700;cursor:pointer;font-size:.9rem}
        .add-btn:hover{opacity:0.9}
        .watchlist-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px}
        .asset-card{background:var(--card);border:1px solid rgba(124,58,237,0.15);border-radius:16px;padding:24px;transition:all .2s}
        .asset-card:hover{border-color:var(--purple);transform:translateY(-2px)}
        .asset-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px}
        .asset-symbol{font-size:1.5rem;font-weight:800}
        .asset-type{font-size:.7rem;background:rgba(124,58,237,0.2);color:var(--purple);padding:4px 8px;border-radius:4px;text-transform:uppercase}
        .asset-price{font-family:'JetBrains Mono',monospace;font-size:1.75rem;font-weight:700;margin-bottom:8px}
        .asset-change{font-size:1rem;font-weight:600}
        .asset-change.up{color:var(--green)}
        .asset-change.down{color:var(--red)}
        .asset-stats{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:16px;padding-top:16px;border-top:1px solid rgba(255,255,255,0.05)}
        .stat{text-align:center}
        .stat-label{font-size:.7rem;color:var(--gray500);margin-bottom:4px}
        .stat-value{font-family:'JetBrains Mono',monospace;font-size:.85rem;font-weight:600}
        .remove-btn{background:transparent;border:1px solid var(--red);color:var(--red);padding:8px 16px;border-radius:8px;cursor:pointer;font-size:.8rem;margin-top:16px;width:100%;transition:all .2s}
        .remove-btn:hover{background:var(--red);color:var(--white)}
        .empty-state{text-align:center;padding:80px 20px;color:var(--gray400)}
        .empty-state h2{margin-bottom:12px;color:var(--white)}
        .empty-state p{margin-bottom:24px}
        
        /* Modal */
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:1000;align-items:center;justify-content:center}
        .modal.active{display:flex}
        .modal-content{background:var(--card);border:1px solid rgba(124,58,237,0.3);border-radius:16px;padding:32px;width:100%;max-width:400px}
        .modal-content h2{margin-bottom:24px}
        .form-group{margin-bottom:20px}
        .form-group label{display:block;font-size:.85rem;color:var(--gray400);margin-bottom:8px}
        .form-group select,.form-group input{width:100%;padding:12px 16px;background:var(--bg);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:var(--white);font-size:1rem}
        .form-group select:focus,.form-group input:focus{outline:none;border-color:var(--purple)}
        .modal-btns{display:flex;gap:12px;margin-top:24px}
        .modal-btns button{flex:1;padding:12px;border-radius:8px;font-weight:600;cursor:pointer}
        .btn-cancel{background:transparent;border:1px solid rgba(255,255,255,0.1);color:var(--gray400)}
        .btn-add{background:linear-gradient(135deg,var(--purple),var(--cyan));border:none;color:var(--white)}
    </style>
</head>
<body>
    <header class="header">
        <a href="/dashboard.html" class="logo">ELUXRAJ™</a>
        <nav class="nav">
            <a href="/dashboard.html">Dashboard</a>
            <a href="/oracle.html">Oracle</a>
            <a href="/weekly-brief.html">Weekly Brief</a>
        </nav>
    </header>
    
    <div class="container">
        <div class="page-header">
            <h1>⭐ My Watchlist</h1>
            <button class="add-btn" onclick="openModal()">+ Add Asset</button>
        </div>
        
        <div id="watchlistGrid" class="watchlist-grid">
            <div style="text-align:center;padding:40px;color:var(--gray400);">Loading watchlist...</div>
        </div>
    </div>
    
    <!-- Add Modal -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <h2>Add to Watchlist</h2>
            <div class="form-group">
                <label>Asset Type</label>
                <select id="assetType" onchange="updateAssetOptions()">
                    <option value="crypto">Crypto</option>
                    <option value="stock">Stock</option>
                </select>
            </div>
            <div class="form-group">
                <label>Asset</label>
                <select id="assetSymbol">
                    <option value="BTC">Bitcoin (BTC)</option>
                    <option value="ETH">Ethereum (ETH)</option>
                    <option value="SOL">Solana (SOL)</option>
                    <option value="XRP">Ripple (XRP)</option>
                    <option value="DOGE">Dogecoin (DOGE)</option>
                    <option value="ADA">Cardano (ADA)</option>
                    <option value="AVAX">Avalanche (AVAX)</option>
                    <option value="LINK">Chainlink (LINK)</option>
                </select>
            </div>
            <div class="modal-btns">
                <button class="btn-cancel" onclick="closeModal()">Cancel</button>
                <button class="btn-add" onclick="addAsset()">Add to Watchlist</button>
            </div>
        </div>
    </div>
    
    <script>
        const API='https://eluxraj-api-production.up.railway.app/api/v1';
        const token=localStorage.getItem('token');
        if(!token){window.location.href='/login.html';}
        
        const COINGECKO='https://api.coingecko.com/api/v3';
        const coinMap={BTC:'bitcoin',ETH:'ethereum',SOL:'solana',XRP:'ripple',DOGE:'dogecoin',ADA:'cardano',AVAX:'avalanche-2',LINK:'chainlink'};
        
        function openModal(){document.getElementById('addModal').classList.add('active');}
        function closeModal(){document.getElementById('addModal').classList.remove('active');}
        
        function updateAssetOptions(){
            const type=document.getElementById('assetType').value;
            const select=document.getElementById('assetSymbol');
            if(type==='crypto'){
                select.innerHTML=`
                    <option value="BTC">Bitcoin (BTC)</option>
                    <option value="ETH">Ethereum (ETH)</option>
                    <option value="SOL">Solana (SOL)</option>
                    <option value="XRP">Ripple (XRP)</option>
                    <option value="DOGE">Dogecoin (DOGE)</option>
                    <option value="ADA">Cardano (ADA)</option>
                    <option value="AVAX">Avalanche (AVAX)</option>
                    <option value="LINK">Chainlink (LINK)</option>
                `;
            }else{
                select.innerHTML=`
                    <option value="AAPL">Apple (AAPL)</option>
                    <option value="TSLA">Tesla (TSLA)</option>
                    <option value="NVDA">NVIDIA (NVDA)</option>
                    <option value="MSFT">Microsoft (MSFT)</option>
                    <option value="GOOGL">Google (GOOGL)</option>
                    <option value="AMZN">Amazon (AMZN)</option>
                    <option value="META">Meta (META)</option>
                `;
            }
        }
        
        async function addAsset(){
            const asset=document.getElementById('assetSymbol').value;
            const type=document.getElementById('assetType').value;
            try{
                const r=await fetch(API+'/watchlist',{
                    method:'POST',
                    headers:{'Authorization':'Bearer '+token,'Content-Type':'application/json'},
                    body:JSON.stringify({asset:asset,asset_type:type})
                });
                const d=await r.json();
                if(d.ok){
                    closeModal();
                    loadWatchlist();
                }else{
                    alert(d.detail||'Failed to add');
                }
            }catch(e){alert('Error adding asset');}
        }
        
        async function removeAsset(symbol){
            if(!confirm('Remove '+symbol+' from watchlist?'))return;
            try{
                await fetch(API+'/watchlist/'+symbol,{
                    method:'DELETE',
                    headers:{'Authorization':'Bearer '+token}
                });
                loadWatchlist();
            }catch(e){console.error(e);}
        }
        
        async function getPrice(symbol,type){
            if(type==='crypto'){
                const id=coinMap[symbol];
                if(!id)return null;
                try{
                    const r=await fetch(COINGECKO+'/simple/price?ids='+id+'&vs_currencies=usd&include_24hr_change=true');
                    const d=await r.json();
                    return{price:d[id]?.usd,change:d[id]?.usd_24h_change};
                }catch(e){return null;}
            }
            return null;
        }
        
        async function loadWatchlist(){
            try{
                const r=await fetch(API+'/watchlist',{headers:{'Authorization':'Bearer '+token}});
                const d=await r.json();
                
                if(!d.ok||!d.items||d.items.length===0){
                    document.getElementById('watchlistGrid').innerHTML=`
                        <div class="empty-state" style="grid-column:1/-1;">
                            <h2>Your watchlist is empty</h2>
                            <p>Add assets to track their prices and get personalized insights.</p>
                            <button class="add-btn" onclick="openModal()">+ Add Your First Asset</button>
                        </div>
                    `;
                    return;
                }
                
                let html='';
                for(const item of d.items){
                    const priceData=await getPrice(item.asset,item.asset_type);
                    const price=priceData?.price?'$'+priceData.price.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2}):'--';
                    const change=priceData?.change||0;
                    const changeClass=change>=0?'up':'down';
                    const changeStr=(change>=0?'+':'')+change.toFixed(2)+'%';
                    
                    html+=`
                        <div class="asset-card">
                            <div class="asset-header">
                                <div class="asset-symbol">${item.asset}</div>
                                <div class="asset-type">${item.asset_type}</div>
                            </div>
                            <div class="asset-price">${price}</div>
                            <div class="asset-change ${changeClass}">${changeStr}</div>
                            <div class="asset-stats">
                                <div class="stat">
                                    <div class="stat-label">Added</div>
                                    <div class="stat-value">${new Date(item.added_at).toLocaleDateString()}</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-label">24h</div>
                                    <div class="stat-value ${changeClass}">${changeStr}</div>
                                </div>
                            </div>
                            <button class="remove-btn" onclick="removeAsset('${item.asset}')">Remove</button>
                        </div>
                    `;
                }
                document.getElementById('watchlistGrid').innerHTML=html;
            }catch(e){
                console.error(e);
                document.getElementById('watchlistGrid').innerHTML='<div style="color:var(--gray400);padding:40px;">Error loading watchlist</div>';
            }
        }
        
        loadWatchlist();
    </script>
</body>
</html>
