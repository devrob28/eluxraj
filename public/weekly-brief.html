<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly AI Brief - ELUXRAJ</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .brief-container { max-width: 900px; margin: 0 auto; padding: 20px; }
        .brief-header { text-align: center; margin-bottom: 30px; }
        .brief-card { background: rgba(124, 58, 237, 0.1); border: 1px solid rgba(124, 58, 237, 0.3); border-radius: 12px; padding: 24px; margin-bottom: 20px; }
        .brief-card h3 { color: #7c3aed; margin-top: 0; }
        .performers-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 16px; }
        .performer-section h4 { margin: 0 0 12px 0; font-size: 14px; color: #9ca3af; }
        .performer-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .performer-item:last-child { border-bottom: none; }
        .change-positive { color: #10b981; }
        .change-negative { color: #ef4444; }
        .scenario-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        .scenario-card { background: rgba(0,0,0,0.3); border-radius: 8px; padding: 16px; }
        .scenario-card.bull { border-left: 3px solid #10b981; }
        .scenario-card.bear { border-left: 3px solid #ef4444; }
        .scenario-card.base { border-left: 3px solid #f59e0b; }
        .scenario-card h4 { margin: 0 0 12px 0; }
        .scenario-card pre { white-space: pre-wrap; font-family: inherit; margin: 0; font-size: 13px; color: #d1d5db; }
        .events-list { list-style: none; padding: 0; }
        .events-list li { padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .events-list li:before { content: "â€¢"; color: #7c3aed; margin-right: 8px; }
        .locked-overlay { text-align: center; padding: 40px; background: rgba(0,0,0,0.5); border-radius: 12px; }
        .asset-type-badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-left: 8px; }
        .badge-crypto { background: #f59e0b; color: black; }
        .badge-stock { background: #3b82f6; color: white; }
        .badge-etf { background: #8b5cf6; color: white; }
        @media (max-width: 768px) {
            .performers-grid, .scenario-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <nav class="nav-bar">
        <a href="index.html" class="nav-logo">ğŸ’ ELUXRAJ</a>
        <div class="nav-links">
            <a href="dashboard.html">Dashboard</a>
            <a href="weekly-brief.html" class="active">Weekly Brief</a>
        </div>
    </nav>

    <main class="brief-container">
        <div class="brief-header">
            <h1>ğŸ“Š Weekly AI Brief</h1>
            <p id="briefTitle" style="color: #9ca3af;">Loading...</p>
        </div>

        <div id="briefContent">
            <!-- Summary -->
            <div class="brief-card">
                <h3>ğŸ“ Summary</h3>
                <p id="briefSummary"></p>
            </div>

            <!-- Market Overview -->
            <div class="brief-card">
                <h3>ğŸ“ˆ Market Overview</h3>
                <p id="marketOverview" style="white-space: pre-line;"></p>
                
                <!-- Crypto Performers -->
                <h4 style="margin-top: 24px; color: #f59e0b;">ğŸª™ Crypto Performance</h4>
                <div class="performers-grid">
                    <div class="performer-section">
                        <h4>ğŸ† Top Performers</h4>
                        <div id="cryptoTopPerformers"></div>
                    </div>
                    <div class="performer-section">
                        <h4>ğŸ“‰ Underperformers</h4>
                        <div id="cryptoWorstPerformers"></div>
                    </div>
                </div>
                
                <!-- Stock Performers -->
                <h4 style="margin-top: 24px; color: #3b82f6;">ğŸ“Š Stock & ETF Performance</h4>
                <div class="performers-grid">
                    <div class="performer-section">
                        <h4>ğŸ† Top Performers</h4>
                        <div id="stockTopPerformers"></div>
                    </div>
                    <div class="performer-section">
                        <h4>ğŸ“‰ Underperformers</h4>
                        <div id="stockWorstPerformers"></div>
                    </div>
                </div>
            </div>

            <!-- Key Events -->
            <div class="brief-card">
                <h3>ğŸ¯ Key Events</h3>
                <ul id="keyEvents" class="events-list"></ul>
            </div>

            <!-- Scenarios -->
            <div class="brief-card">
                <h3>ğŸ”® Market Scenarios</h3>
                <div class="scenario-grid">
                    <div class="scenario-card bull">
                        <h4>ğŸŸ¢ Bull Case</h4>
                        <pre id="bullCase"></pre>
                    </div>
                    <div class="scenario-card bear">
                        <h4>ğŸ”´ Bear Case</h4>
                        <pre id="bearCase"></pre>
                    </div>
                    <div class="scenario-card base">
                        <h4>ğŸŸ¡ Base Case</h4>
                        <pre id="baseCase"></pre>
                    </div>
                </div>
            </div>
        </div>

        <div id="lockedContent" style="display: none;">
            <div class="locked-overlay">
                <h2>ğŸ”’ Premium Content</h2>
                <p>Weekly AI Brief requires Pro or Elite subscription</p>
                <a href="pricing.html" class="btn btn-primary" style="margin-top: 16px;">Upgrade Now</a>
            </div>
        </div>
        
        <div id="noBrief" style="display: none; text-align: center; padding: 40px;">
            <h2>ğŸ“­ No Brief Available</h2>
            <p>Weekly brief will be generated soon.</p>
        </div>
    </main>

    <script>
        const API_BASE = 'https://eluxraj-api-production.up.railway.app';
        
        async function loadBrief() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }
            
            try {
                const res = await fetch(`${API_BASE}/api/v1/weekly-brief`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!res.ok) throw new Error('Failed to load brief');
                
                const data = await res.json();
                
                if (!data.brief) {
                    document.getElementById('briefContent').style.display = 'none';
                    document.getElementById('noBrief').style.display = 'block';
                    return;
                }
                
                const brief = data.brief;
                
                if (brief.locked) {
                    document.getElementById('briefContent').style.display = 'none';
                    document.getElementById('lockedContent').style.display = 'block';
                    document.getElementById('briefTitle').textContent = brief.title;
                    return;
                }
                
                document.getElementById('briefTitle').textContent = brief.title;
                document.getElementById('briefSummary').textContent = brief.summary;
                document.getElementById('marketOverview').textContent = brief.market_overview;
                
                // Crypto performers
                renderPerformers('cryptoTopPerformers', brief.crypto_top_performers || [], 'crypto');
                renderPerformers('cryptoWorstPerformers', brief.crypto_worst_performers || [], 'crypto');
                
                // Stock performers
                renderPerformers('stockTopPerformers', brief.stock_top_performers || [], 'stock');
                renderPerformers('stockWorstPerformers', brief.stock_worst_performers || [], 'stock');
                
                // Key events
                const eventsList = document.getElementById('keyEvents');
                eventsList.innerHTML = (brief.key_events || []).map(e => `<li>${e}</li>`).join('');
                
                // Scenarios
                document.getElementById('bullCase').textContent = brief.bull_case;
                document.getElementById('bearCase').textContent = brief.bear_case;
                document.getElementById('baseCase').textContent = brief.base_case;
                
            } catch (err) {
                console.error(err);
                document.getElementById('briefContent').style.display = 'none';
                document.getElementById('noBrief').style.display = 'block';
            }
        }
        
        function renderPerformers(elementId, performers, defaultType) {
            const container = document.getElementById(elementId);
            if (!performers || performers.length === 0) {
                container.innerHTML = '<p style="color: #6b7280; font-size: 13px;">No data available</p>';
                return;
            }
            
            container.innerHTML = performers.map(p => {
                const change = p.change_7d || p.change || 0;
                const changeClass = change >= 0 ? 'change-positive' : 'change-negative';
                const changePrefix = change >= 0 ? '+' : '';
                const type = p.type || defaultType;
                const badgeClass = type === 'crypto' ? 'badge-crypto' : type === 'etf' ? 'badge-etf' : 'badge-stock';
                
                return `
                    <div class="performer-item">
                        <span>
                            ${p.symbol}
                            <span class="asset-type-badge ${badgeClass}">${type.toUpperCase()}</span>
                        </span>
                        <span class="${changeClass}">${changePrefix}${change.toFixed(1)}%</span>
                    </div>
                `;
            }).join('');
        }
        
        loadBrief();
    </script>
</body>
</html>
