<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOTHAM INTEL | ELUXRAJ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--bg:#000;--card:#0d0d15;--border:rgba(255,255,255,0.1);--purple:#a855f7;--cyan:#22d3ee;--green:#10b981;--red:#ef4444;--yellow:#fbbf24;--white:#fff;--gray300:#d1d5db;--gray400:#9ca3af;--gray500:#6b7280}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--white);min-height:100vh}
        
        .header{display:flex;justify-content:space-between;align-items:center;padding:14px 24px;background:rgba(5,5,10,0.95);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100}
        .logo{display:flex;align-items:center;gap:12px}
        .logo-icon{width:38px;height:38px;background:linear-gradient(135deg,var(--purple),var(--cyan));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px}
        .logo-text{font-size:1.2rem;font-weight:900;letter-spacing:2px;background:linear-gradient(135deg,var(--white),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .nav{display:flex;gap:6px}
        .nav a{padding:8px 16px;color:var(--gray400);text-decoration:none;font-size:.85rem;font-weight:600;border-radius:10px;transition:all .2s}
        .nav a:hover{color:var(--white);background:rgba(255,255,255,0.05)}
        .nav a.active{color:var(--white);background:linear-gradient(135deg,rgba(168,85,247,0.3),rgba(34,211,238,0.2))}
        
        .title-section{padding:32px 24px 24px;text-align:center}
        .page-title{font-size:2.5rem;font-weight:900;letter-spacing:4px;background:linear-gradient(135deg,var(--white),var(--cyan),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:6px}
        .page-subtitle{color:var(--gray500);font-size:.9rem}
        
        .main{display:grid;grid-template-columns:1fr 380px;gap:20px;padding:0 24px 40px;max-width:1600px;margin:0 auto}
        @media(max-width:1100px){.main{grid-template-columns:1fr}}
        
        .card{background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden}
        .card-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid var(--border)}
        .card-title{font-size:.8rem;font-weight:800;letter-spacing:1px;text-transform:uppercase;color:var(--cyan)}
        .card-badge{font-size:.65rem;font-weight:700;padding:4px 10px;border-radius:16px;background:linear-gradient(135deg,var(--green),var(--cyan));color:var(--white)}
        
        .insights-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;padding:18px}
        @media(max-width:900px){.insights-grid{grid-template-columns:repeat(2,1fr)}}
        @media(max-width:500px){.insights-grid{grid-template-columns:1fr}}
        .insight-card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);border-radius:12px;padding:16px;cursor:pointer;transition:all .2s}
        .insight-card:hover{border-color:var(--cyan);transform:translateY(-2px)}
        .insight-tags{display:flex;gap:5px;margin-bottom:12px;flex-wrap:wrap}
        .tag{font-size:.6rem;font-weight:800;padding:4px 8px;border-radius:5px;text-transform:uppercase}
        .tag.bullish{background:rgba(16,185,129,0.2);color:var(--green)}
        .tag.bearish{background:rgba(239,68,68,0.2);color:var(--red)}
        .tag.whale{background:rgba(59,130,246,0.2);color:#3b82f6}
        .tag.important{background:rgba(239,68,68,0.2);color:var(--red)}
        .tag.exchange{background:rgba(251,191,36,0.2);color:var(--yellow)}
        .tag.institution{background:rgba(168,85,247,0.2);color:var(--purple)}
        .tag.on-chain{background:rgba(34,211,238,0.2);color:var(--cyan)}
        .insight-title{font-size:.9rem;font-weight:700;line-height:1.4;margin-bottom:10px}
        .insight-meta{font-size:.7rem;color:var(--gray500)}
        
        .flows-section{padding:18px}
        .flow-item{display:flex;align-items:center;gap:14px;padding:14px;margin-bottom:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);border-radius:12px;transition:all .2s}
        .flow-item:hover{border-color:var(--purple)}
        .flow-icon{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;background:rgba(255,255,255,0.05)}
        .flow-info{flex:1}
        .flow-name{font-size:.95rem;font-weight:700}
        .flow-type{font-size:.7rem;color:var(--gray500)}
        .flow-bars{width:130px}
        .flow-bar-row{display:flex;align-items:center;gap:6px;margin-bottom:5px}
        .flow-bar-label{font-size:.6rem;color:var(--gray500);width:22px}
        .flow-bar{flex:1;height:6px;border-radius:3px;background:rgba(255,255,255,0.05);overflow:hidden}
        .flow-bar-fill{height:100%;border-radius:3px}
        .flow-bar-fill.inflow{background:linear-gradient(90deg,var(--red),var(--yellow))}
        .flow-bar-fill.outflow{background:linear-gradient(90deg,var(--green),var(--cyan))}
        .flow-bar-value{font-family:'JetBrains Mono',monospace;font-size:.65rem;color:var(--gray400);width:50px;text-align:right}
        .flow-net{text-align:right;min-width:80px}
        .flow-net-value{font-family:'JetBrains Mono',monospace;font-size:.95rem;font-weight:800}
        .flow-net-value.positive{color:var(--green)}
        .flow-net-value.negative{color:var(--red)}
        .flow-net-label{font-size:.6rem;color:var(--gray500);text-transform:uppercase}
        
        .sm-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;padding:18px}
        .sm-stat{text-align:center;padding:20px 14px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);border-radius:12px}
        .sm-stat-value{font-family:'JetBrains Mono',monospace;font-size:2rem;font-weight:900;margin-bottom:6px}
        .sm-stat-value.bullish{color:var(--green)}
        .sm-stat-value.bearish{color:var(--red)}
        .sm-stat-label{font-size:.7rem;color:var(--gray400);text-transform:uppercase;letter-spacing:.5px}
        
        .transfer-feed{max-height:600px;overflow-y:auto}
        .transfer-header{display:grid;grid-template-columns:70px 1fr 1fr 36px;gap:10px;padding:12px 16px;font-size:.65rem;font-weight:700;color:var(--gray500);text-transform:uppercase;border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--card)}
        .transfer-row{display:grid;grid-template-columns:70px 1fr 1fr 36px;gap:10px;padding:12px 16px;border-bottom:1px solid rgba(255,255,255,0.03);align-items:center;transition:background .2s}
        .transfer-row:hover{background:rgba(168,85,247,0.05)}
        .transfer-row.new{animation:flashNew .5s ease}
        @keyframes flashNew{0%{background:rgba(34,211,238,0.2)}100%{background:transparent}}
        .transfer-time{font-size:.75rem;color:var(--cyan);font-weight:600}
        .transfer-entity{display:flex;align-items:center;gap:8px}
        .entity-icon{width:28px;height:28px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px}
        .entity-icon.exchange{background:rgba(251,191,36,0.2)}
        .entity-icon.whale{background:rgba(59,130,246,0.2)}
        .entity-name{font-size:.8rem;font-weight:600}
        .entity-amount{font-size:.65rem;color:var(--gray500);font-family:'JetBrains Mono',monospace}
        .impact-dot{width:10px;height:10px;border-radius:50%}
        .impact-dot.bullish{background:var(--green);box-shadow:0 0 6px var(--green)}
        .impact-dot.bearish{background:var(--red);box-shadow:0 0 6px var(--red)}
        
        .skeleton{background:linear-gradient(90deg,var(--card) 25%,rgba(168,85,247,0.1) 50%,var(--card) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:6px}
        @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
        
        .error-state{text-align:center;padding:40px 20px;color:var(--gray400)}
        .error-state .icon{font-size:2.5rem;margin-bottom:12px}
        .error-state .retry-btn{margin-top:12px;padding:10px 20px;background:var(--purple);border:none;border-radius:8px;color:var(--white);font-weight:600;cursor:pointer}
        
        ::-webkit-scrollbar{width:5px}
        ::-webkit-scrollbar-track{background:var(--bg)}
        ::-webkit-scrollbar-thumb{background:var(--purple);border-radius:3px}
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <div class="logo-icon">ü¶á</div>
            <span class="logo-text">ELUXRAJ</span>
        </div>
        <nav class="nav">
            <a href="/dashboard.html">Dashboard</a>
            <a href="/oracle.html">Oracle</a>
            <a href="/whale-intel.html" class="active">Gotham Intel</a>
            <a href="/chart-analysis.html">Chart AI</a>
        </nav>
    </header>
    
    <section class="title-section">
        <h1 class="page-title">GOTHAM INTEL</h1>
        <p class="page-subtitle">Real-time blockchain intelligence ‚Ä¢ Track smart money</p>
    </section>
    
    <main class="main">
        <div class="left-column">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üî• Trending Insights</span>
                    <span class="card-badge" id="insightsBadge">Loading</span>
                </div>
                <div class="insights-grid" id="insightsGrid">
                    <div class="skeleton" style="height:150px"></div>
                    <div class="skeleton" style="height:150px"></div>
                    <div class="skeleton" style="height:150px"></div>
                </div>
            </div>
            
            <div class="card" style="margin-top:20px">
                <div class="card-header">
                    <span class="card-title">üíπ Exchange Flows</span>
                    <span class="card-badge">24H</span>
                </div>
                <div class="flows-section" id="flowsList">
                    <div class="skeleton" style="height:60px;margin-bottom:10px"></div>
                    <div class="skeleton" style="height:60px;margin-bottom:10px"></div>
                    <div class="skeleton" style="height:60px"></div>
                </div>
            </div>
            
            <div class="card" style="margin-top:20px">
                <div class="card-header">
                    <span class="card-title">üß† Smart Money Sentiment</span>
                    <span class="card-badge" id="sentimentBadge">Analyzing</span>
                </div>
                <div class="sm-stats">
                    <div class="sm-stat">
                        <div class="sm-stat-value bullish" id="bullishCount">--</div>
                        <div class="sm-stat-label">Bullish Signals</div>
                    </div>
                    <div class="sm-stat">
                        <div class="sm-stat-value bearish" id="bearishCount">--</div>
                        <div class="sm-stat-label">Bearish Signals</div>
                    </div>
                    <div class="sm-stat">
                        <div class="sm-stat-value" id="netFlow">--</div>
                        <div class="sm-stat-label">Net Flow (24H)</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="right-column">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">‚ö° Live Transfers</span>
                    <span class="card-badge" id="transferCount">0</span>
                </div>
                <div class="transfer-header">
                    <span>Time</span>
                    <span>From</span>
                    <span>To</span>
                    <span></span>
                </div>
                <div class="transfer-feed" id="transferFeed">
                    <div style="padding:20px"><div class="skeleton" style="height:40px;margin-bottom:10px"></div><div class="skeleton" style="height:40px;margin-bottom:10px"></div><div class="skeleton" style="height:40px"></div></div>
                </div>
            </div>
        </div>
    </main>
    
    <script src="/js/eluxraj-utils.js"></script>
    <script>
        const exchangeIcons = {'Binance':'üü°','Coinbase':'üîµ','Kraken':'üü£','OKX':'‚ö´','Bitfinex':'üü¢','Bybit':'üü†'};
        
        (async () => {
            const user = await Auth.check();
            if (!user) return;
            
            loadAll();
            setInterval(loadTransfers, 30000);
            setInterval(loadSentiment, 30000);
        })();
        
        async function loadAll() {
            await Promise.all([loadInsights(), loadFlows(), loadTransfers(), loadSentiment()]);
            Toast.success('Data loaded successfully');
        }
        
        async function loadInsights() {
            try {
                const data = await API.get('/whale/insights');
                if (data.ok && data.insights) {
                    document.getElementById('insightsBadge').textContent = 'Live';
                    document.getElementById('insightsGrid').innerHTML = data.insights.map(i => `
                        <div class="insight-card">
                            <div class="insight-tags">${i.tags.map(t => `<span class="tag ${t}">${t}</span>`).join('')}</div>
                            <div class="insight-title">${i.title}</div>
                            <div class="insight-meta">${i.time} ‚Ä¢ ${i.updates} updates</div>
                        </div>
                    `).join('');
                }
            } catch (e) {
                document.getElementById('insightsGrid').innerHTML = `<div class="error-state"><div class="icon">‚ö†Ô∏è</div><div>${e.message}</div><button class="retry-btn" onclick="loadInsights()">Retry</button></div>`;
            }
        }
        
        async function loadFlows() {
            try {
                const data = await API.get('/whale/flows');
                if (data.ok && data.exchanges) {
                    const max = Math.max(...data.exchanges.map(e => Math.max(e.inflow, e.outflow)));
                    document.getElementById('flowsList').innerHTML = data.exchanges.map(ex => {
                        const icon = exchangeIcons[ex.name] || 'üè¶';
                        const inM = (ex.inflow / 1e6).toFixed(1);
                        const outM = (ex.outflow / 1e6).toFixed(1);
                        const netM = (ex.net_flow / 1e6).toFixed(1);
                        return `
                            <div class="flow-item">
                                <div class="flow-icon">${icon}</div>
                                <div class="flow-info"><div class="flow-name">${ex.name}</div><div class="flow-type">${ex.type}</div></div>
                                <div class="flow-bars">
                                    <div class="flow-bar-row"><span class="flow-bar-label">In</span><div class="flow-bar"><div class="flow-bar-fill inflow" style="width:${(ex.inflow/max)*100}%"></div></div><span class="flow-bar-value">$${inM}M</span></div>
                                    <div class="flow-bar-row"><span class="flow-bar-label">Out</span><div class="flow-bar"><div class="flow-bar-fill outflow" style="width:${(ex.outflow/max)*100}%"></div></div><span class="flow-bar-value">$${outM}M</span></div>
                                </div>
                                <div class="flow-net"><div class="flow-net-value ${ex.net_flow >= 0 ? 'positive' : 'negative'}">${ex.net_flow >= 0 ? '+' : ''}$${netM}M</div><div class="flow-net-label">Net Flow</div></div>
                            </div>`;
                    }).join('');
                }
            } catch (e) {
                document.getElementById('flowsList').innerHTML = `<div class="error-state"><div class="icon">‚ö†Ô∏è</div><div>${e.message}</div><button class="retry-btn" onclick="loadFlows()">Retry</button></div>`;
            }
        }
        
        async function loadTransfers() {
            try {
                const data = await API.get('/whale/transfers?limit=50');
                if (data.ok && data.transfers) {
                    document.getElementById('transferCount').textContent = data.count;
                    document.getElementById('transferFeed').innerHTML = data.transfers.map(tx => `
                        <div class="transfer-row">
                            <div class="transfer-time">${Format.timeAgo(tx.timestamp)}</div>
                            <div class="transfer-entity">
                                <div class="entity-icon ${tx.from.type}">${tx.from.type === 'exchange' ? 'üèõÔ∏è' : 'üêã'}</div>
                                <div><div class="entity-name">${tx.from.name}</div><div class="entity-amount">${formatAmount(tx.amount, tx.symbol)}</div></div>
                            </div>
                            <div class="transfer-entity">
                                <div class="entity-icon ${tx.to.type}">${tx.to.type === 'exchange' ? 'üèõÔ∏è' : 'üêã'}</div>
                                <div><div class="entity-name">${tx.to.name}</div><div class="entity-amount">${Format.currency(tx.amount_usd)}</div></div>
                            </div>
                            <div><div class="impact-dot ${tx.impact}"></div></div>
                        </div>
                    `).join('');
                }
            } catch (e) {
                Toast.error('Failed to load transfers');
            }
        }
        
        async function loadSentiment() {
            try {
                const data = await API.get('/whale/sentiment');
                if (data.ok) {
                    document.getElementById('bullishCount').textContent = data.bullish_signals;
                    document.getElementById('bearishCount').textContent = data.bearish_signals;
                    const netM = (data.net_flow_usd / 1e6).toFixed(1);
                    document.getElementById('netFlow').textContent = `${data.net_flow_usd >= 0 ? '+' : ''}$${netM}M`;
                    document.getElementById('netFlow').className = `sm-stat-value ${data.net_flow_usd >= 0 ? 'bullish' : 'bearish'}`;
                    document.getElementById('sentimentBadge').textContent = data.sentiment;
                }
            } catch (e) {
                Toast.error('Failed to load sentiment');
            }
        }
        
        function formatAmount(amount, symbol) {
            if (amount >= 1000) return amount.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",") + ' ' + symbol;
            return amount.toFixed(2) + ' ' + symbol;
        }
    </script>
</body>
</html>
