<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOTHAM INTEL | ELUXRAJ</title>
    <link rel="stylesheet" href="/css/theme.css">
    <style>
        body{font-family:system-ui,sans-serif;background:#0a0a0f;color:#fff;margin:0;padding:20px}
        .header{display:flex;justify-content:space-between;align-items:center;padding:14px 24px;background:#12121a;border-bottom:1px solid #1e1e2e;margin:-20px -20px 20px}
        .logo{display:flex;align-items:center;gap:12px;font-weight:900;font-size:1.2rem}
        .nav{display:flex;gap:8px}
        .nav a{padding:8px 16px;color:#888;text-decoration:none;font-size:.85rem;border-radius:8px}
        .nav a:hover,.nav a.active{color:#fff;background:#1e1e2e}
        h1{font-size:2rem;text-align:center;margin-bottom:8px;background:linear-gradient(135deg,#a855f7,#06b6d4);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .subtitle{text-align:center;color:#666;margin-bottom:30px}
        .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;max-width:1400px;margin:0 auto}
        @media(max-width:900px){.grid{grid-template-columns:1fr}}
        .card{background:#12121a;border:1px solid #1e1e2e;border-radius:12px;padding:20px}
        .card h2{font-size:.9rem;color:#06b6d4;margin-bottom:16px;text-transform:uppercase;letter-spacing:1px}
        .insight{background:#1a1a24;border-radius:8px;padding:12px;margin-bottom:10px}
        .insight-title{font-weight:600;margin-bottom:6px}
        .insight-meta{font-size:.75rem;color:#666}
        .tag{display:inline-block;font-size:.6rem;padding:3px 6px;border-radius:4px;margin-right:4px;margin-bottom:6px;background:#1e1e2e;color:#888}
        .tag.bullish{background:rgba(16,185,129,0.2);color:#10b981}
        .tag.bearish{background:rgba(239,68,68,0.2);color:#ef4444}
        .stat{display:inline-block;text-align:center;padding:16px;background:#1a1a24;border-radius:8px;margin:5px}
        .stat-value{font-size:1.5rem;font-weight:700}
        .stat-value.green{color:#10b981}
        .stat-value.red{color:#ef4444}
        .stat-label{font-size:.7rem;color:#666;margin-top:4px}
        .transfer{display:flex;justify-content:space-between;padding:10px;border-bottom:1px solid #1e1e2e;font-size:.85rem}
        .transfer:last-child{border:none}
        .dot{display:inline-block;width:8px;height:8px;border-radius:50%;margin-left:8px}
        .dot.bullish{background:#10b981}
        .dot.bearish{background:#ef4444}
        #status{text-align:center;padding:20px;color:#666}
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">ðŸ¦‡ ELUXRAJ</div>
        <nav class="nav">
            <a href="/dashboard.html">Dashboard</a>
            <a href="/oracle.html">Oracle</a>
            <a href="/whale-intel.html" class="active">Gotham Intel</a>
            <a href="/paper-trading.html">Paper Trade</a>
        </nav>
    </header>
    
    <h1>GOTHAM INTEL</h1>
    <p class="subtitle">Whale tracking powered by Whale Alert + MobyScreener</p>
    
    <div id="status">Loading data...</div>
    
    <div class="grid" id="content" style="display:none">
        <div>
            <div class="card">
                <h2>ðŸ”¥ Insights</h2>
                <div id="insights"></div>
            </div>
            
            <div class="card" style="margin-top:20px">
                <h2>ðŸ§  Sentiment</h2>
                <div id="sentiment"></div>
            </div>
        </div>
        
        <div>
            <div class="card">
                <h2>âš¡ Recent Transfers</h2>
                <div id="transfers"></div>
            </div>
        </div>
    </div>
    
    <script src="/js/eluxraj-utils.js"></script>
    <script>
        // Single load, no intervals
        (async function() {
            try {
                const user = await Auth.check();
                if (!user) return;
                
                document.getElementById('status').textContent = 'Fetching whale data...';
                
                // Load one at a time to avoid overwhelming
                await loadInsights();
                await loadSentiment();
                await loadTransfers();
                
                document.getElementById('status').style.display = 'none';
                document.getElementById('content').style.display = 'grid';
                
            } catch(e) {
                document.getElementById('status').textContent = 'Error: ' + e.message;
                console.error(e);
            }
        })();
        
        async function loadInsights() {
            try {
                const data = await API.get('/whale/insights');
                if (data.ok && data.insights) {
                    document.getElementById('insights').innerHTML = data.insights.slice(0,6).map(i => `
                        <div class="insight">
                            <div>${i.tags.map(t => '<span class="tag ' + t + '">' + t + '</span>').join('')}</div>
                            <div class="insight-title">${i.title}</div>
                            <div class="insight-meta">${i.time}</div>
                        </div>
                    `).join('');
                }
            } catch(e) {
                document.getElementById('insights').innerHTML = '<p>Failed to load</p>';
            }
        }
        
        async function loadSentiment() {
            try {
                const data = await API.get('/whale/sentiment');
                if (data.ok) {
                    document.getElementById('sentiment').innerHTML = `
                        <div class="stat"><div class="stat-value">${data.sentiment_emoji || 'ðŸŸ¡'}</div><div class="stat-label">${data.sentiment || 'Neutral'}</div></div>
                        <div class="stat"><div class="stat-value green">${data.bullish_signals || 0}</div><div class="stat-label">Bullish</div></div>
                        <div class="stat"><div class="stat-value red">${data.bearish_signals || 0}</div><div class="stat-label">Bearish</div></div>
                    `;
                }
            } catch(e) {
                document.getElementById('sentiment').innerHTML = '<p>Failed to load</p>';
            }
        }
        
        async function loadTransfers() {
            try {
                const data = await API.get('/whale/transfers?limit=15');
                if (data.ok && data.transfers) {
                    document.getElementById('transfers').innerHTML = data.transfers.slice(0,15).map(tx => `
                        <div class="transfer">
                            <span>${tx.symbol} ${tx.from?.name || '?'} â†’ ${tx.to?.name || '?'}</span>
                            <span>$${((tx.amount_usd||0)/1e6).toFixed(1)}M <span class="dot ${tx.impact}"></span></span>
                        </div>
                    `).join('');
                }
            } catch(e) {
                document.getElementById('transfers').innerHTML = '<p>Failed to load</p>';
            }
        }
    </script>
</body>
</html>
