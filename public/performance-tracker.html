<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Tracker | ELUXRAJ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root{--bg:#0a0a0f;--card:#1a1a24;--purple:#7c3aed;--cyan:#06b6d4;--green:#10b981;--red:#ef4444;--yellow:#f59e0b;--white:#fff;--gray400:#9ca3af;--gray500:#6b7280}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--white);min-height:100vh}
        .header{display:flex;justify-content:space-between;align-items:center;padding:16px 32px;border-bottom:1px solid rgba(124,58,237,0.2)}
        .logo{font-size:1.25rem;font-weight:900;background:linear-gradient(135deg,var(--purple),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none}
        .nav{display:flex;gap:24px;align-items:center}
        .nav a{color:var(--gray400);text-decoration:none;font-size:.9rem}
        .nav a:hover{color:var(--white)}
        .container{max-width:1100px;margin:0 auto;padding:40px 20px}
        .page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px}
        .page-header h1{font-size:1.75rem}
        .period-select{background:var(--card);border:1px solid rgba(255,255,255,0.1);color:var(--white);padding:10px 16px;border-radius:8px;font-size:.9rem}
        
        /* Stats Grid */
        .stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:32px}
        @media(max-width:800px){.stats-grid{grid-template-columns:repeat(2,1fr)}}
        .stat-card{background:var(--card);border:1px solid rgba(124,58,237,0.15);border-radius:12px;padding:20px;text-align:center}
        .stat-value{font-family:'JetBrains Mono',monospace;font-size:1.75rem;font-weight:700;margin-bottom:4px}
        .stat-value.positive{color:var(--green)}
        .stat-value.negative{color:var(--red)}
        .stat-label{font-size:.8rem;color:var(--gray500)}
        
        /* Comparison Section */
        .comparison{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:32px}
        @media(max-width:700px){.comparison{grid-template-columns:1fr}}
        .compare-card{background:var(--card);border:1px solid rgba(124,58,237,0.15);border-radius:16px;padding:24px}
        .compare-card h3{font-size:1rem;margin-bottom:20px;display:flex;align-items:center;gap:10px}
        .compare-card.user{border-color:var(--cyan)}
        .compare-card.signals{border-color:var(--purple)}
        .compare-row{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid rgba(255,255,255,0.05)}
        .compare-row:last-child{border:none}
        .compare-label{color:var(--gray400);font-size:.9rem}
        .compare-value{font-family:'JetBrains Mono',monospace;font-weight:600}
        
        /* Insight Box */
        .insight-box{background:linear-gradient(135deg,rgba(124,58,237,0.1),rgba(6,182,212,0.1));border:1px solid rgba(124,58,237,0.3);border-radius:16px;padding:24px;margin-bottom:32px}
        .insight-box h3{margin-bottom:12px;font-size:1rem}
        .insight-box p{color:var(--gray400);line-height:1.7;font-size:.95rem}
        .insight-box .highlight{color:var(--cyan);font-weight:600}
        
        /* Trades Table */
        .section-title{font-size:1rem;font-weight:700;margin-bottom:16px;display:flex;justify-content:space-between;align-items:center}
        .add-btn{background:linear-gradient(135deg,var(--purple),var(--cyan));color:var(--white);border:none;padding:8px 16px;border-radius:8px;font-weight:600;cursor:pointer;font-size:.85rem}
        .table-container{background:var(--card);border:1px solid rgba(124,58,237,0.15);border-radius:16px;overflow:hidden;margin-bottom:32px}
        table{width:100%;border-collapse:collapse}
        th{background:var(--bg);text-align:left;padding:14px 16px;font-size:.75rem;color:var(--gray500);text-transform:uppercase}
        td{padding:14px 16px;border-top:1px solid rgba(255,255,255,0.05);font-size:.9rem}
        tr:hover{background:rgba(124,58,237,0.05)}
        .side-badge{padding:4px 10px;border-radius:4px;font-size:.75rem;font-weight:600;text-transform:uppercase}
        .side-badge.buy{background:rgba(16,185,129,0.2);color:var(--green)}
        .side-badge.sell{background:rgba(239,68,68,0.2);color:var(--red)}
        .outcome-badge{padding:4px 10px;border-radius:4px;font-size:.75rem;font-weight:600}
        .outcome-badge.win{background:rgba(16,185,129,0.2);color:var(--green)}
        .outcome-badge.loss{background:rgba(239,68,68,0.2);color:var(--red)}
        .outcome-badge.open{background:rgba(245,158,11,0.2);color:var(--yellow)}
        
        /* Modal */
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:1000;align-items:center;justify-content:center}
        .modal.active{display:flex}
        .modal-content{background:var(--card);border:1px solid rgba(124,58,237,0.3);border-radius:16px;padding:32px;width:100%;max-width:450px}
        .modal-content h2{margin-bottom:24px}
        .form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
        .form-group{margin-bottom:16px}
        .form-group label{display:block;font-size:.8rem;color:var(--gray500);margin-bottom:6px}
        .form-group input,.form-group select{width:100%;padding:12px;background:var(--bg);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:var(--white);font-size:.9rem}
        .form-group input:focus,.form-group select:focus{outline:none;border-color:var(--purple)}
        .modal-btns{display:flex;gap:12px;margin-top:24px}
        .modal-btns button{flex:1;padding:12px;border-radius:8px;font-weight:600;cursor:pointer;border:none}
        .btn-cancel{background:var(--bg);color:var(--gray400)}
        .btn-submit{background:linear-gradient(135deg,var(--purple),var(--cyan));color:var(--white)}
        
        .empty-state{text-align:center;padding:40px;color:var(--gray500)}
    </style>
</head>
<body>
    <header class="header">
        <a href="/dashboard.html" class="logo">ELUXRAJ‚Ñ¢</a>
        <nav class="nav">
            <a href="/dashboard.html">Dashboard</a>
            <a href="/watchlist.html">Watchlist</a>
            <a href="/oracle.html">Oracle</a>
        </nav>
    </header>
    
    <div class="container">
        <div class="page-header">
            <h1>üìà Performance Tracker</h1>
            <select class="period-select" id="periodSelect" onchange="loadData()">
                <option value="7">Last 7 Days</option>
                <option value="30" selected>Last 30 Days</option>
                <option value="90">Last 90 Days</option>
            </select>
        </div>
        
        <!-- Quick Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="userTrades">0</div>
                <div class="stat-label">Your Trades</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="signalWinRate">0%</div>
                <div class="stat-label">Signal Win Rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-value positive" id="signalPnl">+0%</div>
                <div class="stat-label">Signal PnL</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="followRate">0%</div>
                <div class="stat-label">Follow Rate</div>
            </div>
        </div>
        
        <!-- Comparison -->
        <div class="comparison">
            <div class="compare-card user">
                <h3>üë§ Your Activity</h3>
                <div class="compare-row">
                    <span class="compare-label">Total Trades</span>
                    <span class="compare-value" id="userTotalTrades">0</span>
                </div>
                <div class="compare-row">
                    <span class="compare-label">Buy Orders</span>
                    <span class="compare-value" id="userBuys">0</span>
                </div>
                <div class="compare-row">
                    <span class="compare-label">Sell Orders</span>
                    <span class="compare-value" id="userSells">0</span>
                </div>
                <div class="compare-row">
                    <span class="compare-label">Total Volume</span>
                    <span class="compare-value" id="userVolume">$0</span>
                </div>
                <div class="compare-row">
                    <span class="compare-label">Assets Traded</span>
                    <span class="compare-value" id="userAssets">0</span>
                </div>
            </div>
            
            <div class="compare-card signals">
                <h3>üîÆ ELUXRAJ Signals</h3>
                <div class="compare-row">
                    <span class="compare-label">Total Signals</span>
                    <span class="compare-value" id="totalSignals">0</span>
                </div>
                <div class="compare-row">
                    <span class="compare-label">Wins</span>
                    <span class="compare-value" style="color:var(--green)" id="signalWins">0</span>
                </div>
                <div class="compare-row">
                    <span class="compare-label">Losses</span>
                    <span class="compare-value" style="color:var(--red)" id="signalLosses">0</span>
                </div>
                <div class="compare-row">
                    <span class="compare-label">Avg Win</span>
                    <span class="compare-value" id="avgWin">+0%</span>
                </div>
                <div class="compare-row">
                    <span class="compare-label">Avg Loss</span>
                    <span class="compare-value" id="avgLoss">0%</span>
                </div>
            </div>
        </div>
        
        <!-- Insight -->
        <div class="insight-box" id="insightBox">
            <h3>üí° Performance Insight</h3>
            <p id="insightText">Loading analysis...</p>
        </div>
        
        <!-- User Trades -->
        <div class="section-title">
            <span>üìù Your Trade History</span>
            <button class="add-btn" onclick="openModal()">+ Log Trade</button>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Asset</th>
                        <th>Side</th>
                        <th>Quantity</th>
                        <th>Price</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody id="tradesTable">
                    <tr><td colspan="6" class="empty-state">Loading trades...</td></tr>
                </tbody>
            </table>
        </div>
        
        <!-- Signal History -->
        <div class="section-title">üîÆ ELUXRAJ Signal History</div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Asset</th>
                        <th>Signal</th>
                        <th>Entry</th>
                        <th>Exit</th>
                        <th>PnL</th>
                        <th>Outcome</th>
                    </tr>
                </thead>
                <tbody id="signalsTable">
                    <tr><td colspan="7" class="empty-state">Loading signals...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Add Trade Modal -->
    <div class="modal" id="tradeModal">
        <div class="modal-content">
            <h2>Log a Trade</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>Asset</label>
                    <input type="text" id="tradeSymbol" placeholder="BTC, ETH, AAPL...">
                </div>
                <div class="form-group">
                    <label>Type</label>
                    <select id="tradeType">
                        <option value="crypto">Crypto</option>
                        <option value="stock">Stock</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Side</label>
                    <select id="tradeSide">
                        <option value="buy">Buy</option>
                        <option value="sell">Sell</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Quantity</label>
                    <input type="number" id="tradeQty" placeholder="0.00" step="any">
                </div>
            </div>
            <div class="form-group">
                <label>Price (USD)</label>
                <input type="number" id="tradePrice" placeholder="0.00" step="any">
            </div>
            <div class="modal-btns">
                <button class="btn-cancel" onclick="closeModal()">Cancel</button>
                <button class="btn-submit" onclick="submitTrade()">Log Trade</button>
            </div>
        </div>
    </div>
    
    <script>
        const API='https://eluxraj-api-production.up.railway.app/api/v1';
        const token=localStorage.getItem('token');
        if(!token){window.location.href='/login.html';}
        
        function openModal(){document.getElementById('tradeModal').classList.add('active');}
        function closeModal(){document.getElementById('tradeModal').classList.remove('active');}
        
        async function loadData(){
            const days=document.getElementById('periodSelect').value;
            await Promise.all([loadStats(days),loadTrades(),loadSignals()]);
        }
        
        async function loadStats(days){
            try{
                const r=await fetch(API+'/performance/stats?days='+days,{headers:{'Authorization':'Bearer '+token}});
                const d=await r.json();
                
                if(d.ok){
                    // Quick stats
                    document.getElementById('userTrades').textContent=d.user.total_trades;
                    document.getElementById('signalWinRate').textContent=d.signals.win_rate+'%';
                    const pnl=d.signals.total_pnl_percent;
                    document.getElementById('signalPnl').textContent=(pnl>=0?'+':'')+pnl+'%';
                    document.getElementById('signalPnl').className='stat-value '+(pnl>=0?'positive':'negative');
                    document.getElementById('followRate').textContent=d.comparison.follow_rate+'%';
                    
                    // User stats
                    document.getElementById('userTotalTrades').textContent=d.user.total_trades;
                    document.getElementById('userBuys').textContent=d.user.buy_trades;
                    document.getElementById('userSells').textContent=d.user.sell_trades;
                    document.getElementById('userVolume').textContent='$'+d.user.total_volume.toLocaleString(undefined,{maximumFractionDigits:0});
                    document.getElementById('userAssets').textContent=d.user.unique_assets;
                    
                    // Signal stats
                    document.getElementById('totalSignals').textContent=d.signals.total_signals;
                    document.getElementById('signalWins').textContent=d.signals.wins;
                    document.getElementById('signalLosses').textContent=d.signals.losses;
                    document.getElementById('avgWin').textContent='+'+d.signals.avg_win_percent+'%';
                    document.getElementById('avgLoss').textContent=d.signals.avg_loss_percent+'%';
                    
                    // Insight
                    generateInsight(d);
                }
            }catch(e){console.error(e);}
        }
        
        function generateInsight(data){
            const el=document.getElementById('insightText');
            const followRate=data.comparison.follow_rate;
            const signalPnl=data.signals.total_pnl_percent;
            const missed=data.comparison.signals_missed;
            
            if(data.user.total_trades===0){
                el.innerHTML='Start logging your trades to see how your performance compares to ELUXRAJ signals. Click <span class="highlight">"+ Log Trade"</span> to get started.';
            }else if(followRate<30&&signalPnl>0){
                el.innerHTML=`You followed only <span class="highlight">${followRate}%</span> of ELUXRAJ signals. If you had followed all signals, you could have captured <span class="highlight">+${signalPnl}%</span> gains. Consider increasing your signal follow rate.`;
            }else if(followRate>=70){
                el.innerHTML=`Great job! You're following <span class="highlight">${followRate}%</span> of ELUXRAJ signals. Keep up the disciplined approach to maximize your trading edge.`;
            }else{
                el.innerHTML=`You've made <span class="highlight">${data.user.total_trades}</span> trades in this period. ELUXRAJ signals achieved a <span class="highlight">${data.signals.win_rate}%</span> win rate. Consider aligning more trades with signals for better results.`;
            }
        }
        
        async function loadTrades(){
            try{
                const r=await fetch(API+'/performance/trades?limit=20',{headers:{'Authorization':'Bearer '+token}});
                const d=await r.json();
                
                if(d.ok&&d.trades.length>0){
                    document.getElementById('tradesTable').innerHTML=d.trades.map(t=>`
                        <tr>
                            <td>${new Date(t.executed_at).toLocaleDateString()}</td>
                            <td><strong>${t.symbol}</strong></td>
                            <td><span class="side-badge ${t.side}">${t.side}</span></td>
                            <td>${t.quantity}</td>
                            <td>$${t.price.toLocaleString()}</td>
                            <td>$${t.total_value.toLocaleString(undefined,{maximumFractionDigits:2})}</td>
                        </tr>
                    `).join('');
                }else{
                    document.getElementById('tradesTable').innerHTML='<tr><td colspan="6" class="empty-state">No trades logged yet. Click "+ Log Trade" to add your first trade.</td></tr>';
                }
            }catch(e){console.error(e);}
        }
        
        async function loadSignals(){
            try{
                const r=await fetch(API+'/performance/signals?limit=20',{headers:{'Authorization':'Bearer '+token}});
                const d=await r.json();
                
                if(d.ok&&d.signals.length>0){
                    document.getElementById('signalsTable').innerHTML=d.signals.map(s=>{
                        const pnl=s.pnl_percent||0;
                        const pnlClass=pnl>=0?'positive':'negative';
                        const outcome=s.outcome||'open';
                        return`
                            <tr>
                                <td>${new Date(s.signal_time).toLocaleDateString()}</td>
                                <td><strong>${s.symbol}</strong></td>
                                <td><span class="side-badge ${s.signal_type}">${s.signal_type}</span></td>
                                <td>$${s.entry_price.toLocaleString()}</td>
                                <td>${s.exit_price?'$'+s.exit_price.toLocaleString():'‚Äî'}</td>
                                <td style="color:var(--${pnlClass==='positive'?'green':'red'})">${pnl>=0?'+':''}${pnl}%</td>
                                <td><span class="outcome-badge ${outcome}">${outcome}</span></td>
                            </tr>
                        `;
                    }).join('');
                }else{
                    document.getElementById('signalsTable').innerHTML='<tr><td colspan="7" class="empty-state">No signal history yet.</td></tr>';
                }
            }catch(e){console.error(e);}
        }
        
        async function submitTrade(){
            const symbol=document.getElementById('tradeSymbol').value.toUpperCase();
            const type=document.getElementById('tradeType').value;
            const side=document.getElementById('tradeSide').value;
            const qty=parseFloat(document.getElementById('tradeQty').value);
            const price=parseFloat(document.getElementById('tradePrice').value);
            
            if(!symbol||!qty||!price){alert('Please fill all fields');return;}
            
            try{
                const r=await fetch(API+'/performance/trades',{
                    method:'POST',
                    headers:{'Authorization':'Bearer '+token,'Content-Type':'application/json'},
                    body:JSON.stringify({symbol,side,quantity:qty,price,asset_type:type,source:'manual'})
                });
                const d=await r.json();
                
                if(d.ok){
                    closeModal();
                    document.getElementById('tradeSymbol').value='';
                    document.getElementById('tradeQty').value='';
                    document.getElementById('tradePrice').value='';
                    loadData();
                }else{
                    alert(d.detail||'Failed to log trade');
                }
            }catch(e){alert('Error logging trade');}
        }
        
        loadData();
    </script>
</body>
</html>
