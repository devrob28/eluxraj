<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D5GE28P625"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag("js", new Date());
  gtag("config", "G-D5GE28P625");
</script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CONVICTION‚Ñ¢ Leaderboard | ELUXRAJ</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg: #000000;
      --card: #0a0a0f;
      --card2: #111118;
      --border: #1a1a2e;
      --accent: #6366f1;
      --accent2: #8b5cf6;
      --green: #10b981;
      --red: #ef4444;
      --gold: #f59e0b;
      --text: #ffffff;
      --muted: #71717a;
    }
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 24px;
      border-bottom: 1px solid var(--border);
      background: var(--card);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .logo {
      font-size: 20px;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .logo span {
      background: linear-gradient(135deg, var(--gold), #fbbf24);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .header-actions { display: flex; gap: 12px; }
    .header-btn {
      padding: 8px 16px;
      background: var(--card2);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 13px;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.3s;
    }
    .header-btn:hover { border-color: var(--accent); }
    .header-btn.primary { background: var(--accent); border-color: var(--accent); }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
    }
    
    /* Stats Banner */
    .stats-banner {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 32px;
    }
    .stat-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      text-align: center;
    }
    .stat-card.highlight {
      background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(251,191,36,0.1));
      border-color: var(--gold);
    }
    .stat-label { font-size: 12px; color: var(--muted); margin-bottom: 4px; }
    .stat-value { font-size: 28px; font-weight: 800; }
    .stat-value.green { color: var(--green); }
    .stat-value.gold { color: var(--gold); }
    
    /* Tabs */
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
    }
    .tab {
      padding: 10px 20px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--muted);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
    }
    .tab:hover { border-color: var(--accent); color: var(--text); }
    .tab.active { background: var(--accent); border-color: var(--accent); color: white; }
    
    /* Leaderboard */
    .leaderboard {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
    }
    .leaderboard-header {
      display: grid;
      grid-template-columns: 60px 1fr 100px 100px 100px 100px;
      padding: 16px 24px;
      border-bottom: 1px solid var(--border);
      font-size: 12px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .leaderboard-row {
      display: grid;
      grid-template-columns: 60px 1fr 100px 100px 100px 100px;
      padding: 16px 24px;
      border-bottom: 1px solid var(--border);
      align-items: center;
      transition: background 0.3s;
    }
    .leaderboard-row:hover { background: var(--card2); }
    .leaderboard-row:last-child { border-bottom: none; }
    .rank {
      font-size: 18px;
      font-weight: 800;
    }
    .rank-1 { color: var(--gold); }
    .rank-2 { color: #c0c0c0; }
    .rank-3 { color: #cd7f32; }
    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: var(--card2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
    }
    .user-name { font-weight: 600; }
    .user-tier {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 4px;
      margin-left: 8px;
    }
    .tier-legend { background: linear-gradient(135deg, var(--gold), #fbbf24); color: black; }
    .tier-master { background: var(--accent); color: white; }
    .tier-expert { background: var(--green); color: white; }
    .tier-pro { background: var(--card2); color: var(--text); }
    .stat-col { text-align: center; font-weight: 600; }
    .stat-col.green { color: var(--green); }
    .stat-col.red { color: var(--red); }
    
    /* Predictions Feed */
    .feed {
      margin-top: 32px;
    }
    .feed-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 16px;
    }
    .prediction-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 12px;
      transition: border-color 0.3s;
    }
    .prediction-card:hover { border-color: var(--accent); }
    .prediction-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .prediction-user {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .prediction-avatar {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: var(--card2);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .prediction-name { font-weight: 600; font-size: 14px; }
    .prediction-time { font-size: 12px; color: var(--muted); }
    .prediction-badge {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
    }
    .badge-long { background: rgba(16,185,129,0.2); color: var(--green); }
    .badge-short { background: rgba(239,68,68,0.2); color: var(--red); }
    .prediction-body {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
    }
    .pred-item { text-align: center; }
    .pred-label { font-size: 11px; color: var(--muted); margin-bottom: 4px; }
    .pred-value { font-size: 18px; font-weight: 700; }
    .prediction-reasoning {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
      font-size: 14px;
      color: var(--muted);
      font-style: italic;
    }
    
    /* Create Prediction Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(10px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .modal-overlay.active { display: flex; }
    .modal {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      width: 100%;
      max-width: 500px;
      padding: 24px;
    }
    .modal h3 { margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
    .form-group { margin-bottom: 16px; }
    .form-label { display: block; font-size: 13px; color: var(--muted); margin-bottom: 6px; }
    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 14px;
      font-family: inherit;
    }
    .form-input:focus, .form-textarea:focus { outline: none; border-color: var(--accent); }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .modal-btns { display: flex; gap: 12px; margin-top: 24px; }
    .modal-btn {
      flex: 1;
      padding: 14px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
    }
    .modal-btn.primary { background: linear-gradient(135deg, var(--accent), var(--accent2)); color: white; }
    .modal-btn.secondary { background: var(--card2); border: 1px solid var(--border); color: var(--text); }
    
    @media (max-width: 900px) {
      .stats-banner { grid-template-columns: repeat(2, 1fr); }
      .leaderboard-header, .leaderboard-row { grid-template-columns: 50px 1fr 80px 80px; }
      .leaderboard-header > *:nth-child(n+5), .leaderboard-row > *:nth-child(n+5) { display: none; }
      .prediction-body { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">üèÜ <span>CONVICTION</span></div>
    <div class="header-actions">
      
      <button class="header-btn primary" onclick="openPredictionModal()">+ New Prediction</button>
      <a href="/dashboard.html" class="header-btn">‚Üê Dashboard</a>
    </div>
  </header>
  
  <div class="container">
    <!-- My Stats -->
    <div class="stats-banner">
      <div class="stat-card highlight">
        <div class="stat-label">Your Rank</div>
        <div class="stat-value gold" id="myRank">#--</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Win Rate</div>
        <div class="stat-value green" id="myWinRate">--%</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Total Return</div>
        <div class="stat-value" id="myReturn">--%</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Predictions</div>
        <div class="stat-value" id="myPredictions">--</div>
      </div>
    </div>
    
    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="showTab('leaderboard', this)">üèÜ Leaderboard</button>
      <button class="tab" onclick="showTab('feed', this)">üìä Live Predictions</button>
      <button class="tab" onclick="showTab('my', this)">üë§ My Predictions</button>
    </div>
    
    <!-- Leaderboard -->
    <div id="leaderboardTab">
      <div class="leaderboard">
        <div class="leaderboard-header">
          <div>Rank</div>
          <div>Trader</div>
          <div>Win Rate</div>
          <div>Return</div>
          <div>Streak</div>
          <div>Calls</div>
        </div>
        <div id="leaderboardBody">
          <div style="padding:40px;text-align:center;color:var(--muted)">Loading...</div>
        </div>
      </div>
    </div>
    
    <!-- Feed -->
    <div id="feedTab" style="display:none">
      <div class="feed">
        <div class="feed-title">üî¥ Live Predictions</div>
        <div id="feedBody">
          <div style="padding:40px;text-align:center;color:var(--muted)">Loading...</div>
        </div>
      </div>
    </div>
    
    <!-- My Predictions -->
    <div id="myTab" style="display:none">
      <div class="feed">
        <div class="feed-title">Your Predictions</div>
        <div id="myBody">
          <div style="padding:40px;text-align:center;color:var(--muted)">Loading...</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Prediction Modal -->
  <div class="modal-overlay" id="predictionModal">
    <div class="modal">
      <h3>üéØ New Prediction</h3>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Asset</label>
          <input class="form-input" id="predAsset" placeholder="BTC, ETH, NVDA...">
        </div>
        <div class="form-group">
          <label class="form-label">Direction</label>
          <select class="form-select" id="predDirection">
            <option value="LONG">üü¢ LONG (Price Up)</option>
            <option value="SHORT">üî¥ SHORT (Price Down)</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Entry Price ($)</label>
          <input class="form-input" id="predEntry" type="number" placeholder="Current price">
        </div>
        <div class="form-group">
          <label class="form-label">Target Price ($)</label>
          <input class="form-input" id="predTarget" type="number" placeholder="Your target">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Timeframe</label>
          <select class="form-select" id="predTimeframe">
            <option value="1 day">1 Day</option>
            <option value="1 week">1 Week</option>
            <option value="2 weeks">2 Weeks</option>
            <option value="1 month">1 Month</option>
            <option value="3 months">3 Months</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Confidence (%)</label>
          <input class="form-input" id="predConfidence" type="number" value="70" min="1" max="100">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Reasoning (Optional)</label>
        <textarea class="form-textarea" id="predReasoning" rows="3" placeholder="Why do you believe this?"></textarea>
      </div>
      <div class="modal-btns">
        <button class="modal-btn secondary" onclick="closePredictionModal()">Cancel</button>
        <button class="modal-btn primary" onclick="submitPrediction()">Submit Prediction</button>
      </div>
    </div>
  </div>
  
  <script>
    const token = localStorage.getItem('token');
    const user = JSON.parse(localStorage.getItem('user') || '{}');
    
    if (!token) window.location.href = '/login.html';
    
    // Load my stats
    async function loadMyStats() {
      try {
        const res = await fetch('/api/conviction/my/stats', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const data = await res.json();
        
        if (data.ok) {
          const s = data.stats;
          document.getElementById('myRank').textContent = '#' + (s.rank || '--');
          document.getElementById('myWinRate').textContent = (s.win_rate || 0).toFixed(1) + '%';
          document.getElementById('myReturn').textContent = (s.total_return >= 0 ? '+' : '') + (s.total_return || 0).toFixed(1) + '%';
          document.getElementById('myPredictions').textContent = s.total_predictions || 0;
          
          const returnEl = document.getElementById('myReturn');
          returnEl.className = 'stat-value ' + (s.total_return >= 0 ? 'green' : 'red');
        }
      } catch (e) {
        console.error('Failed to load stats:', e);
      }
    }
    
    // Load leaderboard
    async function loadLeaderboard() {
      try {
        const res = await fetch('/api/conviction/leaderboard');
        const data = await res.json();
        
        const body = document.getElementById('leaderboardBody');
        
        if (data.ok && data.leaderboard.length > 0) {
          body.innerHTML = data.leaderboard.map((u, i) => {
            const rankClass = i < 3 ? 'rank-' + (i+1) : '';
            const tier = getTierBadge(u.win_rate, u.total_predictions);
            return `
              <div class="leaderboard-row">
                <div class="rank ${rankClass}">${u.rank}</div>
                <div class="user-info">
                  <div class="user-avatar">${(u.user_name || '?').charAt(0).toUpperCase()}</div>
                  <div>
                    <span class="user-name">${u.user_name || 'Anonymous'}</span>
                    <span class="user-tier ${tier.class}">${tier.name}</span>
                  </div>
                </div>
                <div class="stat-col green">${(u.win_rate || 0).toFixed(1)}%</div>
                <div class="stat-col ${u.total_return >= 0 ? 'green' : 'red'}">${u.total_return >= 0 ? '+' : ''}${(u.total_return || 0).toFixed(1)}%</div>
                <div class="stat-col">${u.streak || 0}üî•</div>
                <div class="stat-col">${u.total_predictions || 0}</div>
              </div>
            `;
          }).join('');
        } else {
          body.innerHTML = '<div style="padding:60px;text-align:center;color:var(--muted)">No traders on leaderboard yet. Be the first!</div>';
        }
      } catch (e) {
        console.error('Failed to load leaderboard:', e);
      }
    }
    
    // Get tier badge
    function getTierBadge(winRate, total) {
      if (total < 5) return { name: 'Rookie', class: 'tier-pro' };
      if (winRate >= 70 && total >= 50) return { name: 'Legend', class: 'tier-legend' };
      if (winRate >= 65 && total >= 30) return { name: 'Master', class: 'tier-master' };
      if (winRate >= 60 && total >= 20) return { name: 'Expert', class: 'tier-expert' };
      return { name: 'Pro', class: 'tier-pro' };
    }
    
    // Load feed
    async function loadFeed() {
      try {
        const res = await fetch('/api/conviction/feed');
        const data = await res.json();
        
        const body = document.getElementById('feedBody');
        
        if (data.ok && data.predictions.length > 0) {
          body.innerHTML = data.predictions.map(p => renderPrediction(p)).join('');
        } else {
          body.innerHTML = '<div style="padding:60px;text-align:center;color:var(--muted)">No active predictions yet. Make the first call!</div>';
        }
      } catch (e) {
        console.error('Failed to load feed:', e);
      }
    }
    
    // Load my predictions
    async function loadMyPredictions() {
      try {
        const res = await fetch('/api/conviction/my', {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        const data = await res.json();
        
        const body = document.getElementById('myBody');
        
        if (data.ok && data.predictions.length > 0) {
          body.innerHTML = data.predictions.map(p => renderPrediction(p)).join('');
        } else {
          body.innerHTML = '<div style="padding:60px;text-align:center;color:var(--muted)">You haven\'t made any predictions yet</div>';
        }
      } catch (e) {
        console.error('Failed to load my predictions:', e);
      }
    }
    
    // Render prediction card
    function renderPrediction(p) {
      const isLong = p.direction === 'LONG';
      const time = new Date(p.created_at).toLocaleDateString();
      const pctMove = p.target_price && p.entry_price 
        ? (((p.target_price - p.entry_price) / p.entry_price) * 100 * (isLong ? 1 : -1)).toFixed(1)
        : '--';
      
      return `
        <div class="prediction-card">
          <div class="prediction-header">
            <div class="prediction-user">
              <div class="prediction-avatar">${(p.user_name || '?').charAt(0).toUpperCase()}</div>
              <div>
                <div class="prediction-name">${p.user_name || 'Anonymous'}</div>
                <div class="prediction-time">${time}</div>
              </div>
            </div>
            <div class="prediction-badge ${isLong ? 'badge-long' : 'badge-short'}">${isLong ? 'üü¢ LONG' : 'üî¥ SHORT'}</div>
          </div>
          <div class="prediction-body">
            <div class="pred-item">
              <div class="pred-label">Asset</div>
              <div class="pred-value">${p.asset}</div>
            </div>
            <div class="pred-item">
              <div class="pred-label">Entry</div>
              <div class="pred-value">$${parseFloat(p.entry_price).toLocaleString()}</div>
            </div>
            <div class="pred-item">
              <div class="pred-label">Target</div>
              <div class="pred-value" style="color:${isLong ? 'var(--green)' : 'var(--red)'}">$${p.target_price ? parseFloat(p.target_price).toLocaleString() : '--'}</div>
            </div>
            <div class="pred-item">
              <div class="pred-label">Confidence</div>
              <div class="pred-value">${p.confidence}%</div>
            </div>
          </div>
          ${p.reasoning ? `<div class="prediction-reasoning">"${p.reasoning}"</div>` : ''}
        </div>
      `;
    }
    
    // Tab switching
    function showTab(tab, el) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      el.classList.add('active');
      
      document.getElementById('leaderboardTab').style.display = tab === 'leaderboard' ? 'block' : 'none';
      document.getElementById('feedTab').style.display = tab === 'feed' ? 'block' : 'none';
      document.getElementById('myTab').style.display = tab === 'my' ? 'block' : 'none';
      
      if (tab === 'feed') loadFeed();
      if (tab === 'my') loadMyPredictions();
    }
    
    // Submit prediction
    async function submitPrediction() {
      const asset = document.getElementById('predAsset').value.trim().toUpperCase();
      const direction = document.getElementById('predDirection').value;
      const entryPrice = document.getElementById('predEntry').value;
      const targetPrice = document.getElementById('predTarget').value;
      const timeframe = document.getElementById('predTimeframe').value;
      const confidence = document.getElementById('predConfidence').value;
      const reasoning = document.getElementById('predReasoning').value.trim();
      
      if (!asset || !entryPrice) {
        return alert('Please enter asset and entry price');
      }
      
      try {
        const res = await fetch('/api/conviction/predict', {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer ' + token,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            asset, direction, entryPrice, targetPrice, timeframe, confidence, reasoning
          })
        });
        const data = await res.json();
        
        if (data.ok) {
          closePredictionModal();
          loadMyStats();
          loadFeed();
          alert('Prediction submitted! Good luck üéØ');
        } else {
          alert('Error: ' + data.error);
        }
      } catch (e) {
        alert('Failed to submit prediction');
      }
    }
    
    function openPredictionModal() { document.getElementById('predictionModal').classList.add('active'); }
    function closePredictionModal() { document.getElementById('predictionModal').classList.remove('active'); }
    
    // Init
    loadMyStats();
    loadLeaderboard();
  </script>
</body>
</html>
