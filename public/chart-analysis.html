<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart AI | ELUXRAJ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--bg:#0a0a0f;--card:#12121a;--border:rgba(124,58,237,0.2);--purple:#7c3aed;--cyan:#06b6d4;--green:#10b981;--red:#ef4444;--yellow:#f59e0b;--white:#fff;--gray300:#d1d5db;--gray400:#9ca3af;--gray500:#6b7280}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--white);min-height:100vh}
        
        .header{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-bottom:1px solid var(--border);background:rgba(10,10,15,0.95);position:sticky;top:0;z-index:100}
        .logo{font-size:1.1rem;font-weight:900;background:linear-gradient(135deg,var(--purple),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .nav{display:flex;gap:6px}
        .nav a{padding:8px 16px;color:var(--gray400);text-decoration:none;font-size:.85rem;font-weight:600;border-radius:8px;transition:all .2s}
        .nav a:hover{color:var(--white);background:rgba(255,255,255,0.05)}
        .nav a.active{color:var(--white);background:linear-gradient(135deg,rgba(124,58,237,0.3),rgba(6,182,212,0.2))}
        
        .container{max-width:800px;margin:0 auto;padding:24px}
        .page-title{text-align:center;margin-bottom:24px}
        .page-title h1{font-size:1.8rem;font-weight:800;margin-bottom:6px}
        .page-title p{color:var(--gray500);font-size:.9rem}
        
        .upload-card{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:28px;margin-bottom:24px}
        .section-label{font-size:.7rem;color:var(--gray500);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;font-weight:700}
        
        .asset-tabs{display:flex;gap:6px;margin-bottom:14px;flex-wrap:wrap}
        .asset-tab{padding:8px 14px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:16px;font-size:.75rem;color:var(--gray400);cursor:pointer;transition:all .2s;font-weight:600}
        .asset-tab:hover{border-color:var(--purple);color:var(--white)}
        .asset-tab.active{background:linear-gradient(135deg,var(--purple),var(--cyan));border-color:transparent;color:var(--white)}
        
        .asset-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:6px;max-height:160px;overflow-y:auto;padding:12px;background:rgba(0,0,0,0.3);border-radius:10px;margin-bottom:14px}
        .asset-chip{padding:8px 10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);border-radius:6px;font-size:.75rem;color:var(--gray400);cursor:pointer;text-align:center;transition:all .2s;font-weight:500}
        .asset-chip:hover{border-color:var(--purple);color:var(--white)}
        .asset-chip.selected{background:rgba(124,58,237,0.2);border-color:var(--purple);color:var(--white)}
        
        .selected-asset{display:flex;align-items:center;gap:12px;padding:12px 16px;background:rgba(124,58,237,0.1);border:1px solid rgba(124,58,237,0.3);border-radius:10px;margin-bottom:14px}
        .selected-asset-value{font-size:1rem;font-weight:700}
        .clear-btn{margin-left:auto;color:var(--gray500);cursor:pointer;font-size:16px}
        .clear-btn:hover{color:var(--red)}
        
        .form-row{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px}
        @media(max-width:500px){.form-row{grid-template-columns:1fr}}
        .form-group label{display:block;font-size:.7rem;color:var(--gray500);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px;font-weight:600}
        .form-group select,.form-group input{width:100%;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:10px;padding:12px 14px;color:var(--white);font-size:.9rem;outline:none}
        .form-group select:focus,.form-group input:focus{border-color:var(--purple)}
        .form-group select option{background:#1a1a1a}
        
        .dropzone{border:2px dashed rgba(124,58,237,0.4);border-radius:14px;padding:40px 20px;text-align:center;cursor:pointer;transition:all .2s;margin-bottom:14px}
        .dropzone:hover,.dropzone.dragover{border-color:var(--purple);background:rgba(124,58,237,0.05)}
        .dropzone-icon{font-size:40px;margin-bottom:10px}
        .dropzone-text{color:var(--gray400);font-size:.9rem}
        .dropzone-text span{color:var(--purple)}
        
        .preview{display:none;margin-bottom:14px}
        .preview.active{display:block}
        .preview img{max-width:100%;max-height:250px;border-radius:10px;border:1px solid var(--border)}
        .preview-info{display:flex;justify-content:space-between;align-items:center;margin-top:8px;font-size:.8rem;color:var(--gray500)}
        .remove-btn{color:var(--red);cursor:pointer;background:none;border:none;font-size:.8rem}
        
        .analyze-btn{width:100%;background:linear-gradient(135deg,var(--purple),var(--cyan));border:none;border-radius:12px;padding:16px;color:var(--white);font-size:1rem;font-weight:700;cursor:pointer;transition:all .2s}
        .analyze-btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 24px rgba(124,58,237,0.3)}
        .analyze-btn:disabled{opacity:0.5;cursor:not-allowed}
        
        .results{display:none}
        .results.active{display:block}
        
        .rec-card{border-radius:16px;padding:28px;text-align:center;margin-bottom:20px}
        .rec-card.buy{background:linear-gradient(135deg,rgba(16,185,129,0.15),rgba(52,211,153,0.1));border:1px solid rgba(16,185,129,0.3)}
        .rec-card.sell{background:linear-gradient(135deg,rgba(239,68,68,0.15),rgba(248,113,113,0.1));border:1px solid rgba(239,68,68,0.3)}
        .rec-card.wait{background:linear-gradient(135deg,rgba(245,158,11,0.15),rgba(251,191,36,0.1));border:1px solid rgba(245,158,11,0.3)}
        .rec-label{font-size:.7rem;color:var(--gray500);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px}
        .rec-side{font-size:2.5rem;font-weight:900;text-transform:uppercase;margin-bottom:6px}
        .rec-side.buy{color:var(--green)}
        .rec-side.sell{color:var(--red)}
        .rec-side.wait{color:var(--yellow)}
        .rec-prob{font-size:1.5rem;font-weight:700;margin-bottom:10px}
        .rec-rationale{color:var(--gray400);font-size:.9rem}
        
        .outcomes-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px}
        @media(max-width:500px){.outcomes-grid{grid-template-columns:1fr}}
        .outcomes-section{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px}
        .outcomes-title{font-size:.85rem;font-weight:700;margin-bottom:14px;display:flex;align-items:center;gap:8px}
        .outcomes-title.bullish{color:var(--green)}
        .outcomes-title.bearish{color:var(--red)}
        .outcome-item{padding:12px 0;border-bottom:1px solid rgba(255,255,255,0.05)}
        .outcome-item:last-child{border-bottom:none}
        .outcome-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}
        .outcome-name{font-size:.85rem;font-weight:600}
        .outcome-prob{font-size:.9rem;font-weight:700}
        .outcome-prob.high{color:var(--green)}
        .outcome-prob.medium{color:var(--yellow)}
        .outcome-prob.low{color:var(--gray500)}
        .outcome-explanation{font-size:.75rem;color:var(--gray500)}
        
        .meta-info{display:flex;justify-content:space-between;font-size:.7rem;color:var(--gray600);margin-bottom:14px;flex-wrap:wrap;gap:8px}
        .disclaimer{background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.2);border-radius:10px;padding:12px 14px;font-size:.75rem;color:#f87171;margin-bottom:14px}
        .new-btn{width:100%;background:transparent;border:1px solid var(--border);border-radius:12px;padding:14px;color:var(--gray400);font-size:.9rem;cursor:pointer;transition:all .2s}
        .new-btn:hover{border-color:var(--purple);color:var(--white)}
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">ELUXRAJâ„¢</div>
        <nav class="nav">
            <a href="/dashboard.html">Dashboard</a>
            <a href="/oracle.html">Oracle</a>
            <a href="/whale-intel.html">Gotham Intel</a>
            <a href="/chart-analysis.html" class="active">Chart AI</a>
        </nav>
    </header>
    
    <main class="container">
        <div class="page-title">
            <h1>ðŸ“Š Chart AI Analysis</h1>
            <p>Upload a chart and get AI-powered pattern recognition</p>
        </div>
        
        <div class="upload-card" id="uploadSection">
            <div class="section-label">Select Asset</div>
            <div class="asset-tabs" id="assetTabs">
                <div class="asset-tab active" data-cat="crypto">â‚¿ Crypto</div>
                <div class="asset-tab" data-cat="stocks">ðŸ“ˆ Stocks</div>
                <div class="asset-tab" data-cat="indices">ðŸ“Š Indices</div>
            </div>
            
            <div id="selectedAsset" class="selected-asset" style="display:none">
                <span class="selected-asset-value" id="selectedAssetValue"></span>
                <span class="clear-btn" id="clearAsset">âœ•</span>
            </div>
            
            <div class="asset-grid" id="assetGrid"></div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Custom Ticker</label>
                    <input type="text" id="customAsset" placeholder="e.g. TSLA, DOGE">
                </div>
                <div class="form-group">
                    <label>Timeframe</label>
                    <select id="timeframe">
                        <option value="5m">5 Minutes</option>
                        <option value="15m">15 Minutes</option>
                        <option value="1h" selected>1 Hour</option>
                        <option value="4h">4 Hours</option>
                        <option value="24h">Daily</option>
                    </select>
                </div>
            </div>
            
            <input type="file" id="fileInput" accept="image/*" style="display:none">
            <div class="dropzone" id="dropzone">
                <div class="dropzone-icon">ðŸ“ˆ</div>
                <div class="dropzone-text">Drag & drop chart or <span>browse</span></div>
            </div>
            
            <div class="preview" id="preview">
                <img id="previewImg" src="" alt="Preview">
                <div class="preview-info">
                    <span id="fileName"></span>
                    <button class="remove-btn" id="removeBtn">âœ• Remove</button>
                </div>
            </div>
            
            <button class="analyze-btn" id="analyzeBtn" disabled>ðŸ”® Analyze Chart</button>
        </div>
        
        <div class="results" id="results">
            <div class="rec-card" id="recCard">
                <div class="rec-label">Recommended Action</div>
                <div class="rec-side" id="recSide">BUY</div>
                <div class="rec-prob" id="recProb">42%</div>
                <div class="rec-rationale" id="recRationale"></div>
            </div>
            
            <div class="outcomes-grid">
                <div class="outcomes-section">
                    <div class="outcomes-title bullish">ðŸ“ˆ Bullish Outcomes</div>
                    <div id="bullishOutcomes"></div>
                </div>
                <div class="outcomes-section">
                    <div class="outcomes-title bearish">ðŸ“‰ Bearish Outcomes</div>
                    <div id="bearishOutcomes"></div>
                </div>
            </div>
            
            <div class="meta-info">
                <span id="metaAsset"></span>
                <span id="metaModel"></span>
                <span id="metaTime"></span>
            </div>
            
            <div class="disclaimer" id="disclaimer"></div>
            <button class="new-btn" id="newBtn">ðŸ“Š Analyze Another Chart</button>
        </div>
    </main>
    
    <script src="/js/eluxraj-utils.js"></script>
    <script>
        const ASSETS = {
            crypto: ['BTC-USD','ETH-USD','SOL-USD','BNB-USD','XRP-USD','DOGE-USD','ADA-USD','AVAX-USD','DOT-USD','MATIC-USD','LINK-USD','UNI-USD','ATOM-USD','LTC-USD','PEPE-USD'],
            stocks: ['AAPL','MSFT','GOOGL','AMZN','NVDA','META','TSLA','AMD','NFLX','DIS','BA','JPM','V','WMT','KO'],
            indices: ['SPY','QQQ','DIA','IWM','VTI','VOO']
        };
        
        let selectedAsset = null;
        let selectedFile = null;
        let currentCat = 'crypto';
        
        (async () => {
            const user = await Auth.check();
            if (!user) return;
            renderAssets('crypto');
        })();
        
        // Asset tabs
        document.getElementById('assetTabs').addEventListener('click', e => {
            if (e.target.classList.contains('asset-tab')) {
                document.querySelectorAll('.asset-tab').forEach(t => t.classList.remove('active'));
                e.target.classList.add('active');
                currentCat = e.target.dataset.cat;
                renderAssets(currentCat);
            }
        });
        
        function renderAssets(cat) {
            document.getElementById('assetGrid').innerHTML = ASSETS[cat].map(a => 
                `<div class="asset-chip ${selectedAsset === a ? 'selected' : ''}" data-asset="${a}">${a}</div>`
            ).join('');
        }
        
        document.getElementById('assetGrid').addEventListener('click', e => {
            if (e.target.classList.contains('asset-chip')) selectAsset(e.target.dataset.asset);
        });
        
        function selectAsset(asset) {
            selectedAsset = asset;
            document.getElementById('selectedAssetValue').textContent = asset;
            document.getElementById('selectedAsset').style.display = 'flex';
            renderAssets(currentCat);
            updateBtn();
        }
        
        document.getElementById('clearAsset').onclick = () => {
            selectedAsset = null;
            document.getElementById('selectedAsset').style.display = 'none';
            renderAssets(currentCat);
            updateBtn();
        };
        
        document.getElementById('customAsset').addEventListener('keypress', e => {
            if (e.key === 'Enter' && e.target.value.trim()) {
                selectAsset(e.target.value.trim().toUpperCase());
                e.target.value = '';
            }
        });
        
        // File handling
        const dropzone = document.getElementById('dropzone');
        const fileInput = document.getElementById('fileInput');
        
        dropzone.onclick = () => fileInput.click();
        dropzone.ondragover = e => { e.preventDefault(); dropzone.classList.add('dragover'); };
        dropzone.ondragleave = () => dropzone.classList.remove('dragover');
        dropzone.ondrop = e => { e.preventDefault(); dropzone.classList.remove('dragover'); if (e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]); };
        fileInput.onchange = () => { if (fileInput.files[0]) handleFile(fileInput.files[0]); };
        
        function handleFile(file) {
            if (!file.type.startsWith('image/')) { Toast.error('Please upload an image'); return; }
            selectedFile = file;
            document.getElementById('fileName').textContent = file.name;
            const reader = new FileReader();
            reader.onload = e => {
                document.getElementById('previewImg').src = e.target.result;
                document.getElementById('preview').classList.add('active');
                dropzone.style.display = 'none';
                updateBtn();
            };
            reader.readAsDataURL(file);
        }
        
        document.getElementById('removeBtn').onclick = () => {
            selectedFile = null;
            fileInput.value = '';
            document.getElementById('preview').classList.remove('active');
            dropzone.style.display = 'block';
            updateBtn();
        };
        
        function updateBtn() {
            document.getElementById('analyzeBtn').disabled = !(selectedAsset && selectedFile);
        }
        
        // Analyze
        document.getElementById('analyzeBtn').onclick = async () => {
            if (!selectedAsset || !selectedFile) return;
            
            const timeframe = document.getElementById('timeframe').value;
            Loading.show('Analyzing chart patterns...');
            
            try {
                const formData = new FormData();
                formData.append('asset', selectedAsset);
                formData.append('timeframe', timeframe);
                formData.append('file', selectedFile);
                
                const data = await API.postForm('/chart/analyze', formData);
                displayResults(data);
                Toast.success('Analysis complete!');
            } catch (e) {
                Toast.error(e.message);
            } finally {
                Loading.hide();
            }
        };
        
        function displayResults(data) {
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('results').classList.add('active');
            
            const side = data.recommended_trade.side.toLowerCase();
            document.getElementById('recCard').className = 'rec-card ' + side;
            document.getElementById('recSide').className = 'rec-side ' + side;
            document.getElementById('recSide').textContent = side.toUpperCase();
            document.getElementById('recProb').textContent = Math.round(data.recommended_trade.probability * 100) + '%';
            document.getElementById('recRationale').textContent = data.recommended_trade.rationale;
            
            document.getElementById('bullishOutcomes').innerHTML = data.bullish.map(o => `
                <div class="outcome-item">
                    <div class="outcome-header">
                        <span class="outcome-name">${o.name}</span>
                        <span class="outcome-prob ${o.probability >= 0.3 ? 'high' : o.probability >= 0.15 ? 'medium' : 'low'}">${Math.round(o.probability * 100)}%</span>
                    </div>
                    <div class="outcome-explanation">${o.explanation}</div>
                </div>
            `).join('');
            
            document.getElementById('bearishOutcomes').innerHTML = data.bearish.map(o => `
                <div class="outcome-item">
                    <div class="outcome-header">
                        <span class="outcome-name">${o.name}</span>
                        <span class="outcome-prob ${o.probability >= 0.3 ? 'high' : o.probability >= 0.15 ? 'medium' : 'low'}">${Math.round(o.probability * 100)}%</span>
                    </div>
                    <div class="outcome-explanation">${o.explanation}</div>
                </div>
            `).join('');
            
            document.getElementById('metaAsset').textContent = `${data.asset} â€¢ ${data.timeframe}`;
            document.getElementById('metaModel').textContent = `Model: ${data.model_version}`;
            document.getElementById('metaTime').textContent = `Generated: ${new Date(data.generated_at).toLocaleString()}`;
            document.getElementById('disclaimer').textContent = data.disclaimer;
        }
        
        document.getElementById('newBtn').onclick = () => {
            document.getElementById('results').classList.remove('active');
            document.getElementById('uploadSection').style.display = 'block';
            selectedFile = null;
            fileInput.value = '';
            document.getElementById('preview').classList.remove('active');
            dropzone.style.display = 'block';
            updateBtn();
        };
    </script>
</body>
</html>
