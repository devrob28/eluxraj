<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart AI Analysis | ELUXRAJ</title>
    <link rel="stylesheet" href="/css/theme.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
        
        .header{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-bottom:1px solid var(--border);background:rgba(5,5,8,0.95);backdrop-filter:blur(10px);position:sticky;top:0;z-index:100}
        .logo{font-size:1.1rem;font-weight:900;background:linear-gradient(135deg,#7c3aed,#06b6d4);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none}
        .nav{display:flex;gap:6px}
        .nav a{padding:8px 16px;color:#9ca3af;text-decoration:none;font-size:.85rem;font-weight:600;border-radius:8px;transition:all .2s}
        .nav a:hover{color:#fff;background:rgba(255,255,255,0.05)}
        .nav a.active{color:#fff;background:linear-gradient(135deg,rgba(124,58,237,0.2),rgba(6,182,212,0.1));border:1px solid rgba(124,58,237,0.2)}
        
        .container{max-width:900px;margin:0 auto;padding:24px}
        
        .page-title{text-align:center;margin-bottom:32px}
        .page-title h1{font-size:2rem;font-weight:900;margin-bottom:8px}
        .page-title h1 span{background:linear-gradient(135deg,#7c3aed,#06b6d4);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .page-title p{color:#9ca3af;font-size:.95rem}
        
        .upload-card{background:#12121a;border:1px solid rgba(124,58,237,0.2);border-radius:20px;padding:28px;margin-bottom:24px}
        
        .section-label{font-size:.7rem;color:#6b7280;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:12px;font-weight:700}
        
        .category-tabs{display:flex;gap:8px;margin-bottom:16px}
        .category-tab{padding:10px 20px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:10px;color:#9ca3af;font-size:.85rem;font-weight:600;cursor:pointer;transition:all .2s}
        .category-tab:hover{border-color:#7c3aed;color:#fff}
        .category-tab.active{background:linear-gradient(135deg,#7c3aed,#06b6d4);border-color:transparent;color:#fff}
        
        .asset-grid{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:20px;display:none}
        .asset-grid.active{display:flex}
        .asset-btn{padding:8px 14px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:8px;color:#9ca3af;font-size:.8rem;font-weight:500;cursor:pointer;transition:all .2s}
        .asset-btn:hover{border-color:#7c3aed;color:#fff}
        .asset-btn.selected{background:rgba(124,58,237,0.2);border-color:#7c3aed;color:#fff}
        
        .custom-input-section{margin-bottom:20px}
        .custom-input-row{display:flex;gap:12px}
        .custom-input{flex:1;padding:14px 16px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:10px;color:#fff;font-size:.95rem;font-weight:500}
        .custom-input:focus{outline:none;border-color:#7c3aed}
        .custom-input::placeholder{color:#6b7280}
        
        .timeframe-select{width:200px;padding:14px 16px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:10px;color:#fff;font-size:.95rem;cursor:pointer}
        .timeframe-select:focus{outline:none;border-color:#7c3aed}
        .timeframe-select option{background:#12121a;color:#fff}
        
        .dropzone{border:2px dashed rgba(124,58,237,0.3);border-radius:16px;padding:40px;text-align:center;cursor:pointer;transition:all .2s;margin-bottom:20px}
        .dropzone:hover,.dropzone.dragover{border-color:#7c3aed;background:rgba(124,58,237,0.05)}
        .dropzone-icon{font-size:3rem;margin-bottom:12px}
        .dropzone-text{color:#9ca3af;font-size:.9rem}
        .dropzone-text strong{color:#fff}
        
        .preview-container{display:none;margin-bottom:20px}
        .preview-container.active{display:block}
        .preview-img{max-width:100%;max-height:300px;border-radius:12px;border:1px solid rgba(255,255,255,0.1)}
        .preview-info{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
        .preview-name{color:#9ca3af;font-size:.85rem}
        .preview-remove{color:#ef4444;font-size:.85rem;cursor:pointer;font-weight:600}
        .preview-remove:hover{text-decoration:underline}
        
        .analyze-btn{width:100%;background:linear-gradient(135deg,#7c3aed,#06b6d4);border:none;border-radius:12px;padding:16px;color:#fff;font-size:1rem;font-weight:700;cursor:pointer;transition:all .2s;box-shadow:0 4px 15px rgba(124,58,237,0.3)}
        .analyze-btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 20px rgba(124,58,237,0.4)}
        .analyze-btn:disabled{opacity:0.5;cursor:not-allowed}
        
        .results-card{background:#12121a;border:1px solid rgba(124,58,237,0.2);border-radius:20px;padding:28px;display:none}
        .results-card.active{display:block}
        
        .result-header{text-align:center;padding:24px;border-radius:16px;margin-bottom:24px}
        .result-header.buy{background:linear-gradient(135deg,rgba(16,185,129,0.15),rgba(6,182,212,0.1))}
        .result-header.sell{background:linear-gradient(135deg,rgba(239,68,68,0.15),rgba(245,158,11,0.1))}
        .result-header.wait{background:linear-gradient(135deg,rgba(245,158,11,0.15),rgba(124,58,237,0.1))}
        .result-label{font-size:.7rem;color:#9ca3af;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px}
        .result-action{font-size:2.5rem;font-weight:900;margin-bottom:4px}
        .result-action.buy{color:#10b981}
        .result-action.sell{color:#ef4444}
        .result-action.wait{color:#f59e0b}
        .result-prob{font-size:1.5rem;font-weight:700;color:#fff;margin-bottom:8px}
        .result-rationale{color:#9ca3af;font-size:.9rem;max-width:500px;margin:0 auto}
        
        .outcomes-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:24px}
        @media(max-width:700px){.outcomes-grid{grid-template-columns:1fr}}
        
        .outcome-card{background:rgba(255,255,255,0.02);border-radius:16px;padding:20px}
        .outcome-card.bullish{border-left:3px solid #10b981}
        .outcome-card.bearish{border-left:3px solid #ef4444}
        .outcome-title{font-size:.85rem;font-weight:700;margin-bottom:16px;display:flex;align-items:center;gap:8px}
        .outcome-title.bullish{color:#10b981}
        .outcome-title.bearish{color:#ef4444}
        
        .outcome-item{padding:12px 0;border-bottom:1px solid rgba(255,255,255,0.05)}
        .outcome-item:last-child{border-bottom:none}
        .outcome-name{font-weight:600;font-size:.9rem;margin-bottom:4px;display:flex;justify-content:space-between}
        .outcome-name span{color:#9ca3af;font-weight:700}
        .outcome-name span.bullish{color:#10b981}
        .outcome-name span.bearish{color:#ef4444}
        .outcome-desc{color:#6b7280;font-size:.8rem;line-height:1.4}
        
        .result-meta{display:flex;justify-content:space-between;color:#6b7280;font-size:.75rem;padding-top:16px;border-top:1px solid rgba(255,255,255,0.05)}
        
        .disclaimer{background:rgba(245,158,11,0.05);border:1px solid rgba(245,158,11,0.2);border-radius:12px;padding:16px;font-size:.8rem;color:#f59e0b;margin-top:24px}
        
        .new-analysis-btn{display:block;text-align:center;color:#7c3aed;font-weight:600;margin-top:20px;cursor:pointer}
        .new-analysis-btn:hover{text-decoration:underline}
        
        .loading{display:none;text-align:center;padding:40px}
        .loading.active{display:block}
        .spinner{width:50px;height:50px;border:3px solid rgba(124,58,237,0.2);border-top-color:#7c3aed;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 16px}
        @keyframes spin{to{transform:rotate(360deg)}}
    </style>
</head>
<body>
    <header class="header">
        <a href="/dashboard.html" class="logo">ELUXRAJâ„¢</a>
        <nav class="nav">
            <a href="/dashboard.html">Dashboard</a>
            <a href="/oracle.html">Oracle</a>
            <a href="/whale-intel.html">Gotham Intel</a>
            <a href="/chart-analysis.html" class="active">Chart AI</a>
            <a href="/paper-trading.html">Paper Trade</a>
        </nav>
    </header>
    
    <main class="container">
        <div class="page-title">
            <h1>ðŸ“Š <span>Chart AI</span> Analysis</h1>
            <p>Upload any chart and get AI-powered pattern recognition</p>
        </div>
        
        <!-- Upload Card -->
        <div class="upload-card" id="uploadCard">
            <div class="section-label">SELECT ASSET TYPE</div>
            <div class="category-tabs">
                <button class="category-tab active" data-category="custom">ðŸŽ¯ Any Asset</button>
                <button class="category-tab" data-category="crypto">â‚¿ Crypto</button>
                <button class="category-tab" data-category="stocks">ðŸ“ˆ Stocks</button>
                <button class="category-tab" data-category="indices">ðŸ“Š Indices</button>
            </div>
            
            <!-- Custom/Any Asset Input (default) -->
            <div class="custom-input-section" id="customSection">
                <div class="section-label">ENTER TICKER SYMBOL</div>
                <div class="custom-input-row">
                    <input type="text" class="custom-input" id="customTicker" placeholder="Enter any ticker: WOLF-USD, SPY, EURUSD, etc.">
                    <select class="timeframe-select" id="timeframeSelect">
                        <option value="5m">5 Minutes</option>
                        <option value="15m">15 Minutes</option>
                        <option value="30m">30 Minutes</option>
                        <option value="1h" selected>1 Hour</option>
                        <option value="2h">2 Hours</option>
                        <option value="4h">4 Hours</option>
                        <option value="8h">8 Hours</option>
                        <option value="12h">12 Hours</option>
                        <option value="24h">Daily</option>
                        <option value="3d">3 Day</option>
                        <option value="1M">Monthly</option>
                    </select>
                </div>
            </div>
            
            <!-- Crypto Presets -->
            <div class="asset-grid" id="cryptoGrid">
                <button class="asset-btn" data-asset="BTC-USD">BTC-USD</button>
                <button class="asset-btn" data-asset="ETH-USD">ETH-USD</button>
                <button class="asset-btn" data-asset="SOL-USD">SOL-USD</button>
                <button class="asset-btn" data-asset="BNB-USD">BNB-USD</button>
                <button class="asset-btn" data-asset="XRP-USD">XRP-USD</button>
                <button class="asset-btn" data-asset="DOGE-USD">DOGE-USD</button>
                <button class="asset-btn" data-asset="ADA-USD">ADA-USD</button>
                <button class="asset-btn" data-asset="AVAX-USD">AVAX-USD</button>
                <button class="asset-btn" data-asset="LINK-USD">LINK-USD</button>
                <button class="asset-btn" data-asset="MATIC-USD">MATIC-USD</button>
            </div>
            
            <!-- Stocks Presets -->
            <div class="asset-grid" id="stocksGrid">
                <button class="asset-btn" data-asset="AAPL">AAPL</button>
                <button class="asset-btn" data-asset="MSFT">MSFT</button>
                <button class="asset-btn" data-asset="NVDA">NVDA</button>
                <button class="asset-btn" data-asset="TSLA">TSLA</button>
                <button class="asset-btn" data-asset="GOOGL">GOOGL</button>
                <button class="asset-btn" data-asset="AMZN">AMZN</button>
                <button class="asset-btn" data-asset="META">META</button>
                <button class="asset-btn" data-asset="AMD">AMD</button>
                <button class="asset-btn" data-asset="NFLX">NFLX</button>
                <button class="asset-btn" data-asset="SPY">SPY</button>
            </div>
            
            <!-- Indices Presets -->
            <div class="asset-grid" id="indicesGrid">
                <button class="asset-btn" data-asset="SPX">S&P 500</button>
                <button class="asset-btn" data-asset="NDX">NASDAQ</button>
                <button class="asset-btn" data-asset="DJI">Dow Jones</button>
                <button class="asset-btn" data-asset="VIX">VIX</button>
                <button class="asset-btn" data-asset="DXY">US Dollar</button>
                <button class="asset-btn" data-asset="EURUSD">EUR/USD</button>
                <button class="asset-btn" data-asset="GBPUSD">GBP/USD</button>
                <button class="asset-btn" data-asset="GOLD">Gold</button>
                <button class="asset-btn" data-asset="SILVER">Silver</button>
                <button class="asset-btn" data-asset="OIL">Crude Oil</button>
            </div>
            
            <!-- Timeframe for preset selections -->
            <div class="custom-input-section" id="presetTimeframe" style="display:none">
                <div class="section-label">TIMEFRAME</div>
                <select class="timeframe-select" id="presetTimeframeSelect" style="width:100%">
                    <option value="5m">5 Minutes</option>
                    <option value="15m">15 Minutes</option>
                    <option value="30m">30 Minutes</option>
                    <option value="1h" selected>1 Hour</option>
                    <option value="2h">2 Hours</option>
                    <option value="4h">4 Hours</option>
                    <option value="8h">8 Hours</option>
                    <option value="12h">12 Hours</option>
                    <option value="24h">Daily</option>
                    <option value="3d">3 Day</option>
                    <option value="1M">Monthly</option>
                </select>
            </div>
            
            <div class="section-label" style="margin-top:20px">UPLOAD CHART</div>
            <div class="dropzone" id="dropzone">
                <div class="dropzone-icon">ðŸ“ˆ</div>
                <div class="dropzone-text"><strong>Click to upload</strong> or drag and drop<br>PNG, JPG up to 10MB</div>
                <input type="file" id="fileInput" accept="image/*" hidden>
            </div>
            
            <div class="preview-container" id="previewContainer">
                <img id="previewImg" class="preview-img">
                <div class="preview-info">
                    <span class="preview-name" id="previewName"></span>
                    <span class="preview-remove" id="removeFile">âœ• Remove</span>
                </div>
            </div>
            
            <button class="analyze-btn" id="analyzeBtn" disabled>ðŸ”® Analyze Chart</button>
        </div>
        
        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <div style="color:#9ca3af">Analyzing chart patterns...</div>
        </div>
        
        <!-- Results Card -->
        <div class="results-card" id="resultsCard">
            <div class="result-header" id="resultHeader">
                <div class="result-label">RECOMMENDED ACTION</div>
                <div class="result-action" id="resultAction">BUY</div>
                <div class="result-prob" id="resultProb">72%</div>
                <div class="result-rationale" id="resultRationale"></div>
            </div>
            
            <div class="outcomes-grid">
                <div class="outcome-card bullish">
                    <div class="outcome-title bullish">ðŸ“ˆ Bullish Outcomes</div>
                    <div id="bullishOutcomes"></div>
                </div>
                <div class="outcome-card bearish">
                    <div class="outcome-title bearish">ðŸ“‰ Bearish Outcomes</div>
                    <div id="bearishOutcomes"></div>
                </div>
            </div>
            
            <div class="result-meta">
                <span id="resultAsset">BTC-USD â€¢ 4h</span>
                <span id="resultModel">Model: cnn-v1.0</span>
                <span id="resultTime">Generated: --</span>
            </div>
            
            <div class="disclaimer">
                ELUXRAJ provides AI-powered analysis for informational purposes only. This is NOT financial advice. Always do your own research.
            </div>
            
            <div class="new-analysis-btn" id="newAnalysis">ðŸ“Š Analyze Another Chart</div>
        </div>
    </main>
    
    <script src="/js/eluxraj-utils.js"></script>
    <script>
        let selectedAsset = '';
        let selectedFile = null;
        let currentCategory = 'custom';
        
        // Category tab switching
        document.querySelectorAll('.category-tab').forEach(tab => {
            tab.onclick = () => {
                document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentCategory = tab.dataset.category;
                
                // Hide all grids
                document.querySelectorAll('.asset-grid').forEach(g => g.classList.remove('active'));
                document.getElementById('customSection').style.display = 'none';
                document.getElementById('presetTimeframe').style.display = 'none';
                
                // Show relevant section
                if (currentCategory === 'custom') {
                    document.getElementById('customSection').style.display = 'block';
                    selectedAsset = document.getElementById('customTicker').value.trim().toUpperCase();
                } else if (currentCategory === 'crypto') {
                    document.getElementById('cryptoGrid').classList.add('active');
                    document.getElementById('presetTimeframe').style.display = 'block';
                } else if (currentCategory === 'stocks') {
                    document.getElementById('stocksGrid').classList.add('active');
                    document.getElementById('presetTimeframe').style.display = 'block';
                } else if (currentCategory === 'indices') {
                    document.getElementById('indicesGrid').classList.add('active');
                    document.getElementById('presetTimeframe').style.display = 'block';
                }
                
                // Clear preset selection when switching
                document.querySelectorAll('.asset-btn').forEach(b => b.classList.remove('selected'));
                if (currentCategory !== 'custom') selectedAsset = '';
                updateBtn();
            };
        });
        
        // Custom ticker input
        document.getElementById('customTicker').oninput = (e) => {
            selectedAsset = e.target.value.trim().toUpperCase();
            updateBtn();
        };
        
        // Asset button clicks
        document.querySelectorAll('.asset-btn').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('.asset-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                selectedAsset = btn.dataset.asset;
                updateBtn();
            };
        });
        
        // File handling
        const dropzone = document.getElementById('dropzone');
        const fileInput = document.getElementById('fileInput');
        const previewContainer = document.getElementById('previewContainer');
        const previewImg = document.getElementById('previewImg');
        const previewName = document.getElementById('previewName');
        
        dropzone.onclick = () => fileInput.click();
        dropzone.ondragover = (e) => { e.preventDefault(); dropzone.classList.add('dragover'); };
        dropzone.ondragleave = () => dropzone.classList.remove('dragover');
        dropzone.ondrop = (e) => {
            e.preventDefault();
            dropzone.classList.remove('dragover');
            if (e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]);
        };
        fileInput.onchange = () => { if (fileInput.files[0]) handleFile(fileInput.files[0]); };
        
        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                Toast.error('Please upload an image file');
                return;
            }
            selectedFile = file;
            previewImg.src = URL.createObjectURL(file);
            previewName.textContent = file.name;
            previewContainer.classList.add('active');
            dropzone.style.display = 'none';
            updateBtn();
        }
        
        document.getElementById('removeFile').onclick = () => {
            selectedFile = null;
            previewContainer.classList.remove('active');
            dropzone.style.display = 'block';
            fileInput.value = '';
            updateBtn();
        };
        
        function updateBtn() {
            const hasAsset = selectedAsset && selectedAsset.length > 0;
            document.getElementById('analyzeBtn').disabled = !(hasAsset && selectedFile);
        }
        
        // Analyze
        document.getElementById('analyzeBtn').onclick = async () => {
            if (!selectedAsset || !selectedFile) return;
            
            const timeframe = currentCategory === 'custom' 
                ? document.getElementById('timeframeSelect').value 
                : document.getElementById('presetTimeframeSelect').value;
            
            document.getElementById('uploadCard').style.display = 'none';
            document.getElementById('loading').classList.add('active');
            
            try {
                const formData = new FormData();
                formData.append('asset', selectedAsset);
                formData.append('timeframe', timeframe);
                formData.append('file', selectedFile);
                
                const data = await API.postForm('/chart/analyze', formData);
                showResults(data);
            } catch (err) {
                Toast.error(err.message || 'Analysis failed');
                document.getElementById('uploadCard').style.display = 'block';
            } finally {
                document.getElementById('loading').classList.remove('active');
            }
        };
        
        function showResults(data) {
            const header = document.getElementById('resultHeader');
            const action = document.getElementById('resultAction');
            const side = data.recommended_trade?.side || 'wait';
            
            header.className = 'result-header ' + side;
            action.className = 'result-action ' + side;
            action.textContent = side.toUpperCase();
            
            document.getElementById('resultProb').textContent = Math.round((data.recommended_trade?.probability || 0) * 100) + '%';
            document.getElementById('resultRationale').textContent = data.recommended_trade?.rationale || '';
            
            // Bullish outcomes
            const bullishHtml = (data.bullish || []).map(o => `
                <div class="outcome-item">
                    <div class="outcome-name">${o.name} <span class="bullish">${Math.round(o.probability * 100)}%</span></div>
                    <div class="outcome-desc">${o.explanation}</div>
                </div>
            `).join('') || '<div class="outcome-item"><div class="outcome-desc">No bullish patterns detected</div></div>';
            document.getElementById('bullishOutcomes').innerHTML = bullishHtml;
            
            // Bearish outcomes
            const bearishHtml = (data.bearish || []).map(o => `
                <div class="outcome-item">
                    <div class="outcome-name">${o.name} <span class="bearish">${Math.round(o.probability * 100)}%</span></div>
                    <div class="outcome-desc">${o.explanation}</div>
                </div>
            `).join('') || '<div class="outcome-item"><div class="outcome-desc">No bearish patterns detected</div></div>';
            document.getElementById('bearishOutcomes').innerHTML = bearishHtml;
            
            // Meta
            document.getElementById('resultAsset').textContent = `${data.asset} â€¢ ${data.timeframe}`;
            document.getElementById('resultModel').textContent = `Model: ${data.model_version}`;
            document.getElementById('resultTime').textContent = `Generated: ${new Date().toLocaleString()}`;
            
            document.getElementById('resultsCard').classList.add('active');
        }
        
        document.getElementById('newAnalysis').onclick = () => {
            document.getElementById('resultsCard').classList.remove('active');
            document.getElementById('uploadCard').style.display = 'block';
            
            // Reset
            selectedFile = null;
            previewContainer.classList.remove('active');
            dropzone.style.display = 'block';
            fileInput.value = '';
            updateBtn();
        };
        
        // Initialize - show custom section by default
        document.getElementById('customSection').style.display = 'block';
    </script>
</body>
</html>
