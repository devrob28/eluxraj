<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORACLE | ELUXRAJ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--bg:#050508;--card:#0a0a12;--purple:#7c3aed;--cyan:#06b6d4;--green:#10b981;--red:#ef4444;--yellow:#f59e0b;--white:#fff;--gray300:#d1d5db;--gray400:#9ca3af;--gray500:#6b7280;--gray600:#4b5563}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--white);min-height:100vh}
        .header{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-bottom:1px solid rgba(124,58,237,0.2);background:rgba(5,5,8,0.95);position:sticky;top:0;z-index:100}
        .logo{font-size:1.1rem;font-weight:900;background:linear-gradient(135deg,var(--purple),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .nav{display:flex;gap:8px}
        .nav a{padding:8px 16px;color:var(--gray400);text-decoration:none;font-size:.85rem;font-weight:600;border-radius:8px;transition:all .2s}
        .nav a:hover{color:var(--white);background:rgba(255,255,255,0.05)}
        .nav a.active{color:var(--white);background:linear-gradient(135deg,rgba(124,58,237,0.3),rgba(6,182,212,0.2))}
        .container{max-width:1400px;margin:0 auto;padding:24px}
        
        /* Token selector */
        .token-bar{display:flex;gap:8px;margin-bottom:24px;flex-wrap:wrap}
        .token-btn{padding:10px 20px;background:var(--card);border:1px solid rgba(124,58,237,0.2);border-radius:10px;color:var(--gray400);font-size:.85rem;font-weight:600;cursor:pointer;transition:all .2s}
        .token-btn:hover{border-color:var(--purple);color:var(--white)}
        .token-btn.active{background:linear-gradient(135deg,var(--purple),var(--cyan));border-color:transparent;color:var(--white)}
        .token-btn.loading{opacity:0.5;pointer-events:none}
        
        /* Score card */
        .score-section{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:24px}
        @media(max-width:900px){.score-section{grid-template-columns:1fr}}
        .score-card{background:var(--card);border:1px solid rgba(124,58,237,0.2);border-radius:20px;padding:32px;text-align:center}
        .score-card.bullish{border-color:rgba(16,185,129,0.4);background:linear-gradient(135deg,rgba(16,185,129,0.1),transparent)}
        .score-card.bearish{border-color:rgba(239,68,68,0.4);background:linear-gradient(135deg,rgba(239,68,68,0.1),transparent)}
        .score-card.neutral{border-color:rgba(245,158,11,0.4);background:linear-gradient(135deg,rgba(245,158,11,0.1),transparent)}
        .score-label{font-size:.75rem;color:var(--gray500);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
        .score-value{font-family:'JetBrains Mono',monospace;font-size:4rem;font-weight:900;margin-bottom:8px}
        .score-value.bullish{color:var(--green)}
        .score-value.bearish{color:var(--red)}
        .score-value.neutral{color:var(--yellow)}
        .score-signal{font-size:1.5rem;font-weight:800;text-transform:uppercase;margin-bottom:16px}
        .score-signal.bullish{color:var(--green)}
        .score-signal.bearish{color:var(--red)}
        .score-signal.neutral{color:var(--yellow)}
        .score-reasoning{color:var(--gray400);font-size:.9rem;line-height:1.6}
        
        /* Metrics grid */
        .metrics-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px}
        @media(max-width:1000px){.metrics-grid{grid-template-columns:repeat(2,1fr)}}
        @media(max-width:500px){.metrics-grid{grid-template-columns:1fr}}
        .metric-card{background:var(--card);border:1px solid rgba(124,58,237,0.15);border-radius:14px;padding:20px}
        .metric-icon{font-size:1.5rem;margin-bottom:8px}
        .metric-label{font-size:.7rem;color:var(--gray500);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px}
        .metric-value{font-family:'JetBrains Mono',monospace;font-size:1.3rem;font-weight:700}
        .metric-sub{font-size:.75rem;color:var(--gray500);margin-top:4px}
        
        /* Components */
        .components{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
        @media(max-width:800px){.components{grid-template-columns:1fr}}
        .component{background:var(--card);border:1px solid rgba(124,58,237,0.15);border-radius:14px;padding:20px}
        .component-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
        .component-title{font-size:.85rem;font-weight:700;color:var(--gray300)}
        .component-value{font-family:'JetBrains Mono',monospace;font-weight:700}
        .component-bar{height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;margin-bottom:8px}
        .component-fill{height:100%;border-radius:4px;transition:width .5s ease}
        .component-fill.bullish{background:linear-gradient(90deg,var(--green),var(--cyan))}
        .component-fill.bearish{background:linear-gradient(90deg,var(--red),var(--yellow))}
        .component-fill.neutral{background:linear-gradient(90deg,var(--yellow),var(--cyan))}
        .component-desc{font-size:.75rem;color:var(--gray500)}
        
        /* Skeleton loading */
        .skeleton{background:linear-gradient(90deg,var(--card) 25%,rgba(124,58,237,0.1) 50%,var(--card) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:8px}
        @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
        .skeleton-text{height:20px;margin-bottom:8px}
        .skeleton-score{height:80px;width:150px;margin:0 auto 16px}
        .skeleton-bar{height:8px;margin-top:8px}
        
        /* Error state */
        .error-state{text-align:center;padding:60px 20px;color:var(--gray400)}
        .error-state .icon{font-size:3rem;margin-bottom:16px}
        .error-state .message{font-size:1rem;margin-bottom:16px}
        .error-state .retry-btn{padding:12px 24px;background:var(--purple);border:none;border-radius:10px;color:var(--white);font-weight:600;cursor:pointer}
        .error-state .retry-btn:hover{opacity:0.9}
        
        /* Last updated */
        .last-updated{text-align:center;padding:16px;color:var(--gray600);font-size:.75rem}
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">ELUXRAJ‚Ñ¢</div>
        <nav class="nav">
            <a href="/dashboard.html">Dashboard</a>
            <a href="/oracle.html" class="active">Oracle</a>
            <a href="/whale-intel.html">Gotham Intel</a>
            <a href="/chart-analysis.html">Chart AI</a>
        </nav>
    </header>
    
    <main class="container">
        <div class="token-bar" id="tokenBar">
            <button class="token-btn active" data-symbol="BTC">‚Çø Bitcoin</button>
            <button class="token-btn" data-symbol="ETH">Œû Ethereum</button>
            <button class="token-btn" data-symbol="SOL">‚óé Solana</button>
            <button class="token-btn" data-symbol="BNB">BNB</button>
            <button class="token-btn" data-symbol="XRP">XRP</button>
            <button class="token-btn" data-symbol="DOGE">DOGE</button>
        </div>
        
        <div id="content">
            <!-- Content loaded dynamically -->
        </div>
        
        <div class="last-updated" id="lastUpdated"></div>
    </main>
    
    <script src="/js/eluxraj-utils.js"></script>
    <script>
        let currentSymbol = 'BTC';
        let isLoading = false;
        
        // Initialize
        (async () => {
            const user = await Auth.check();
            if (!user) return;
            
            // Check subscription
            if (user.subscription_tier === 'free') {
                document.getElementById('content').innerHTML = `
                    <div class="error-state">
                        <div class="icon">üîí</div>
                        <div class="message">ORACLE is an Elite feature</div>
                        <a href="/pricing.html" class="retry-btn">Upgrade to Elite</a>
                    </div>
                `;
                return;
            }
            
            loadOracle(currentSymbol);
        })();
        
        // Token selection
        document.getElementById('tokenBar').addEventListener('click', (e) => {
            if (e.target.classList.contains('token-btn') && !isLoading) {
                document.querySelectorAll('.token-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                currentSymbol = e.target.dataset.symbol;
                loadOracle(currentSymbol);
            }
        });
        
        async function loadOracle(symbol) {
            if (isLoading) return;
            isLoading = true;
            
            // Show skeleton
            document.getElementById('content').innerHTML = renderSkeleton();
            document.querySelectorAll('.token-btn').forEach(b => b.classList.add('loading'));
            
            try {
                const data = await retry(() => API.get(`/oracle/${symbol}`), 3, 1000);
                renderOracle(data);
                document.getElementById('lastUpdated').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
            } catch (error) {
                Toast.error(error.message);
                document.getElementById('content').innerHTML = `
                    <div class="error-state">
                        <div class="icon">‚ö†Ô∏è</div>
                        <div class="message">${error.message}</div>
                        <button class="retry-btn" onclick="loadOracle('${symbol}')">Retry</button>
                    </div>
                `;
            } finally {
                isLoading = false;
                document.querySelectorAll('.token-btn').forEach(b => b.classList.remove('loading'));
            }
        }
        
        function renderSkeleton() {
            return `
                <div class="score-section">
                    <div class="score-card">
                        <div class="skeleton skeleton-text" style="width:100px;margin:0 auto"></div>
                        <div class="skeleton skeleton-score"></div>
                        <div class="skeleton skeleton-text" style="width:80px;margin:0 auto"></div>
                    </div>
                    <div class="score-card">
                        <div class="skeleton skeleton-text" style="width:100px;margin:0 auto"></div>
                        <div class="skeleton skeleton-score"></div>
                        <div class="skeleton skeleton-text" style="width:200px;margin:0 auto"></div>
                    </div>
                </div>
                <div class="metrics-grid">
                    ${[1,2,3,4].map(() => `
                        <div class="metric-card">
                            <div class="skeleton skeleton-text" style="width:40px"></div>
                            <div class="skeleton skeleton-text" style="width:60px"></div>
                            <div class="skeleton skeleton-text" style="width:100px"></div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function renderOracle(data) {
            const signal = getSignal(data.oracle_score);
            const signalClass = signal.toLowerCase();
            
            document.getElementById('content').innerHTML = `
                <div class="score-section">
                    <div class="score-card ${signalClass}">
                        <div class="score-label">ORACLE Score</div>
                        <div class="score-value ${signalClass}">${data.oracle_score}</div>
                        <div class="score-signal ${signalClass}">${signal}</div>
                    </div>
                    <div class="score-card">
                        <div class="score-label">AI Analysis</div>
                        <div class="score-reasoning">${data.reasoning || 'Analysis based on whale activity, technical indicators, sentiment data, and liquidation risk assessment.'}</div>
                        <div style="margin-top:16px;display:flex;gap:16px;justify-content:center;flex-wrap:wrap">
                            <div style="text-align:center">
                                <div style="font-size:.7rem;color:var(--gray500)">Price</div>
                                <div style="font-family:'JetBrains Mono';font-weight:700">${Format.currency(data.price || 0)}</div>
                            </div>
                            <div style="text-align:center">
                                <div style="font-size:.7rem;color:var(--gray500)">24h Change</div>
                                <div style="font-family:'JetBrains Mono';font-weight:700;color:${(data.price_change_24h || 0) >= 0 ? 'var(--green)' : 'var(--red)'}">${Format.percent(data.price_change_24h || 0)}</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-icon">üêã</div>
                        <div class="metric-label">Whale Score</div>
                        <div class="metric-value">${data.components?.whale_score || '--'}/100</div>
                        <div class="metric-sub">Large holder activity</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">üìä</div>
                        <div class="metric-label">Technical Score</div>
                        <div class="metric-value">${data.components?.technical_score || '--'}/100</div>
                        <div class="metric-sub">Chart indicators</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">üí¨</div>
                        <div class="metric-label">Sentiment Score</div>
                        <div class="metric-value">${data.components?.sentiment_score || '--'}/100</div>
                        <div class="metric-sub">Social & news</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">‚ö†Ô∏è</div>
                        <div class="metric-label">Risk Score</div>
                        <div class="metric-value">${data.components?.liquidation_risk || '--'}/100</div>
                        <div class="metric-sub">Liquidation risk</div>
                    </div>
                </div>
                
                <div class="components">
                    ${renderComponent('Whale Activity', data.components?.whale_score, 'Large transactions and accumulation patterns', signalClass)}
                    ${renderComponent('Technical Indicators', data.components?.technical_score, 'RSI, MACD, moving averages', signalClass)}
                    ${renderComponent('Market Sentiment', data.components?.sentiment_score, 'Social media and news analysis', signalClass)}
                    ${renderComponent('Liquidation Risk', data.components?.liquidation_risk, 'Leverage and liquidation levels', signalClass)}
                </div>
            `;
        }
        
        function renderComponent(title, value, desc, signalClass) {
            const v = value || 50;
            return `
                <div class="component">
                    <div class="component-header">
                        <span class="component-title">${title}</span>
                        <span class="component-value" style="color:${v >= 60 ? 'var(--green)' : v <= 40 ? 'var(--red)' : 'var(--yellow)'}">${v}/100</span>
                    </div>
                    <div class="component-bar">
                        <div class="component-fill ${v >= 60 ? 'bullish' : v <= 40 ? 'bearish' : 'neutral'}" style="width:${v}%"></div>
                    </div>
                    <div class="component-desc">${desc}</div>
                </div>
            `;
        }
        
        function getSignal(score) {
            if (score >= 70) return 'Bullish';
            if (score <= 30) return 'Bearish';
            return 'Neutral';
        }
    </script>
</body>
</html>
