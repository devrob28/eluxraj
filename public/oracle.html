<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORACLE v3.0 | ELUXRAJ</title>
    <link rel="stylesheet" href="/css/theme.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
        
        .header{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-bottom:1px solid var(--border);background:rgba(5,5,8,0.95);backdrop-filter:blur(10px);position:sticky;top:0;z-index:100}
        .logo{font-size:1.1rem;font-weight:900;background:linear-gradient(135deg,#7c3aed,#06b6d4);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none}
        .nav{display:flex;gap:6px}
        .nav a{padding:8px 16px;color:#9ca3af;text-decoration:none;font-size:.85rem;font-weight:600;border-radius:8px;transition:all .2s}
        .nav a:hover{color:#fff;background:rgba(255,255,255,0.05)}
        .nav a.active{color:#fff;background:linear-gradient(135deg,rgba(124,58,237,0.2),rgba(6,182,212,0.1));border:1px solid rgba(124,58,237,0.2)}
        
        .container{max-width:1400px;margin:0 auto;padding:24px}
        
        .version-badge{display:inline-flex;align-items:center;gap:6px;background:linear-gradient(135deg,rgba(124,58,237,0.2),rgba(6,182,212,0.1));border:1px solid rgba(124,58,237,0.2);border-radius:20px;padding:6px 14px;font-size:.75rem;font-weight:700;color:#06b6d4;margin-bottom:16px}
        .version-badge .dot{width:6px;height:6px;background:#10b981;border-radius:50%;animation:pulse 2s infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
        
        .token-bar{display:flex;gap:8px;margin-bottom:24px;flex-wrap:wrap}
        .token-btn{padding:10px 20px;background:#12121a;border:1px solid rgba(255,255,255,0.08);border-radius:10px;color:#9ca3af;font-size:.85rem;font-weight:600;cursor:pointer;transition:all .2s}
        .token-btn:hover{border-color:#7c3aed;color:#fff}
        .token-btn.active{background:linear-gradient(135deg,#7c3aed,#06b6d4);border-color:transparent;color:#fff}
        .token-btn:disabled{opacity:0.5;cursor:not-allowed}
        
        .main-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:24px}
        @media(max-width:1000px){.main-grid{grid-template-columns:1fr}}
        
        .score-card{background:#12121a;border:1px solid rgba(124,58,237,0.2);border-radius:20px;padding:32px;text-align:center;position:relative;overflow:hidden}
        .score-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,#7c3aed,#06b6d4)}
        .score-card.bullish{border-color:rgba(16,185,129,0.3)}
        .score-card.bullish::before{background:linear-gradient(90deg,#10b981,#06b6d4)}
        .score-card.bearish{border-color:rgba(239,68,68,0.3)}
        .score-card.bearish::before{background:linear-gradient(90deg,#ef4444,#f59e0b)}
        .score-label{font-size:.7rem;color:#9ca3af;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px}
        .score-value{font-family:'JetBrains Mono',monospace;font-size:4.5rem;font-weight:900;line-height:1;margin-bottom:8px}
        .score-value.bullish{background:linear-gradient(135deg,#10b981,#06b6d4);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .score-value.bearish{background:linear-gradient(135deg,#ef4444,#f59e0b);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .score-value.neutral{background:linear-gradient(135deg,#f59e0b,#7c3aed);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .score-signal{display:inline-block;font-size:1rem;font-weight:800;text-transform:uppercase;padding:8px 20px;border-radius:8px;margin-bottom:16px}
        .score-signal.bullish{background:rgba(16,185,129,0.15);color:#10b981}
        .score-signal.bearish{background:rgba(239,68,68,0.15);color:#ef4444}
        .score-signal.neutral{background:rgba(245,158,11,0.15);color:#f59e0b}
        .score-meta{display:flex;justify-content:center;gap:24px;margin-top:16px}
        .score-meta-item{text-align:center}
        .score-meta-label{font-size:.65rem;color:#6b7280;text-transform:uppercase}
        .score-meta-value{font-family:'JetBrains Mono',monospace;font-size:1.1rem;font-weight:700}
        .score-meta-value.up{color:#10b981}
        .score-meta-value.down{color:#ef4444}
        
        .info-card{background:#12121a;border:1px solid rgba(124,58,237,0.2);border-radius:20px;padding:24px}
        .info-header{display:flex;align-items:center;gap:10px;margin-bottom:20px}
        .info-title{font-size:.85rem;font-weight:800;text-transform:uppercase;letter-spacing:1px;color:#06b6d4}
        .info-badge{font-size:.6rem;font-weight:700;padding:4px 8px;border-radius:4px;background:rgba(124,58,237,0.2);color:#7c3aed}
        
        .factor-list{display:flex;flex-direction:column;gap:10px}
        .factor-item{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:rgba(255,255,255,0.02);border-radius:8px}
        .factor-name{font-size:.8rem;color:#9ca3af}
        .factor-value{font-family:'JetBrains Mono',monospace;font-size:.85rem;font-weight:600}
        .factor-value.high{color:#10b981}
        .factor-value.medium{color:#f59e0b}
        .factor-value.low{color:#ef4444}
        
        .section-title{font-size:.75rem;font-weight:800;text-transform:uppercase;letter-spacing:1.5px;color:#6b7280;margin-bottom:16px;display:flex;align-items:center;gap:8px}
        .section-title::after{content:'';flex:1;height:1px;background:rgba(255,255,255,0.06)}
        
        .metrics-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:24px}
        @media(max-width:900px){.metrics-grid{grid-template-columns:repeat(2,1fr)}}
        .metric-card{background:#12121a;border:1px solid rgba(255,255,255,0.06);border-radius:14px;padding:16px}
        .metric-icon{font-size:1.3rem;margin-bottom:6px}
        .metric-label{font-size:.65rem;color:#6b7280;text-transform:uppercase;letter-spacing:.5px;margin-bottom:2px}
        .metric-value{font-family:'JetBrains Mono',monospace;font-size:1.2rem;font-weight:700}
        .metric-sub{font-size:.7rem;color:#6b7280;margin-top:2px}
        
        .reasoning-card{background:#12121a;border:1px solid rgba(124,58,237,0.2);border-radius:16px;padding:24px;margin-bottom:24px}
        .reasoning-title{font-size:.8rem;font-weight:800;text-transform:uppercase;letter-spacing:1px;color:#06b6d4;margin-bottom:12px}
        .reasoning-text{font-size:.95rem;color:#d1d5db;line-height:1.6}
        .reasoning-bullets{margin-top:12px;display:flex;flex-direction:column;gap:8px}
        .reasoning-bullet{display:flex;align-items:flex-start;gap:8px;font-size:.85rem;color:#9ca3af}
        .reasoning-bullet::before{content:'‚Üí';color:#06b6d4}
        
        .skeleton{background:linear-gradient(90deg,#12121a 25%,rgba(124,58,237,0.1) 50%,#12121a 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:8px}
        @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
        
        .error-state{text-align:center;padding:60px 20px}
        .error-state .icon{font-size:3rem;margin-bottom:16px}
        .error-state .title{font-size:1.2rem;font-weight:700;margin-bottom:8px}
        .error-state .message{color:#9ca3af;margin-bottom:16px}
        .error-state .retry-btn{padding:12px 24px;background:#7c3aed;border:none;border-radius:10px;color:#fff;font-weight:600;cursor:pointer}
        .error-state .retry-btn:hover{background:#6d28d9}
        
        .upgrade-state{text-align:center;padding:60px 20px;background:#12121a;border:1px solid rgba(124,58,237,0.2);border-radius:20px}
        .upgrade-state .icon{font-size:3rem;margin-bottom:16px}
        .upgrade-state .title{font-size:1.5rem;font-weight:800;margin-bottom:8px}
        .upgrade-state .message{color:#9ca3af;margin-bottom:20px;max-width:400px;margin-left:auto;margin-right:auto}
        .upgrade-state .upgrade-btn{display:inline-block;padding:14px 28px;background:linear-gradient(135deg,#7c3aed,#06b6d4);border:none;border-radius:12px;color:#fff;font-weight:700;text-decoration:none;cursor:pointer}
        
        .last-updated{text-align:center;padding:16px;color:#6b7280;font-size:.75rem}
        
        .disclaimer{background:rgba(239,68,68,0.05);border:1px solid rgba(239,68,68,0.2);border-radius:12px;padding:16px;font-size:.75rem;color:#6b7280;margin-top:24px}
        .disclaimer strong{color:#ef4444}
    </style>
</head>
<body>
    <header class="header">
        <a href="/dashboard.html" class="logo">ELUXRAJ‚Ñ¢</a>
        <nav class="nav">
            <a href="/dashboard.html">Dashboard</a>
            <a href="/oracle.html" class="active">Oracle</a>
            <a href="/whale-intel.html">Gotham Intel</a>
            <a href="/chart-analysis.html">Chart AI</a>
        </nav>
    </header>
    
    <main class="container">
        <div class="version-badge">
            <span class="dot"></span>
            ORACLE v3.0 ‚Äî Institutional Grade
        </div>
        
        <div class="token-bar" id="tokenBar">
            <button class="token-btn active" data-symbol="BTC">‚Çø Bitcoin</button>
            <button class="token-btn" data-symbol="ETH">Œû Ethereum</button>
            <button class="token-btn" data-symbol="SOL">‚óé Solana</button>
            <button class="token-btn" data-symbol="BNB">BNB</button>
            <button class="token-btn" data-symbol="XRP">XRP</button>
            <button class="token-btn" data-symbol="DOGE">DOGE</button>
        </div>
        
        <div id="content">
            <div class="main-grid">
                <div class="score-card"><div class="skeleton" style="height:280px"></div></div>
                <div class="info-card"><div class="skeleton" style="height:280px"></div></div>
            </div>
        </div>
        
        <div class="last-updated" id="lastUpdated"></div>
        
        <div class="disclaimer">
            <strong>‚ö†Ô∏è Not Financial Advice:</strong> ORACLE signals are for informational purposes only. Past performance does not guarantee future results. Always do your own research and consult a financial advisor.
        </div>
    </main>
    
    <script src="/js/eluxraj-utils.js"></script>
    <script>
        let currentSymbol = 'BTC';
        let isLoading = false;
        let currentUser = null;
        
        // Initialize
        (async () => {
            try {
                currentUser = await Auth.check();
                if (!currentUser) return;
                
                console.log('User:', currentUser.email, 'Tier:', currentUser.subscription_tier);
                
                if (currentUser.subscription_tier === 'free') {
                    showUpgradePrompt();
                    return;
                }
                
                loadOracle(currentSymbol);
            } catch (err) {
                console.error('Init error:', err);
                showError('Authentication failed. Please login again.');
            }
        })();
        
        // Token bar click handler
        document.getElementById('tokenBar').onclick = (e) => {
            if (e.target.classList.contains('token-btn') && !isLoading) {
                document.querySelectorAll('.token-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                currentSymbol = e.target.dataset.symbol;
                loadOracle(currentSymbol);
            }
        };
        
        function showUpgradePrompt() {
            document.getElementById('content').innerHTML = `
                <div class="upgrade-state">
                    <div class="icon">üîí</div>
                    <div class="title">ORACLE v3.0 - Elite Feature</div>
                    <div class="message">Unlock institutional-grade trading signals with AI-powered analysis, whale tracking, and quant models.</div>
                    <a href="/pricing.html" class="upgrade-btn">Upgrade to Elite ‚Äî $98/mo</a>
                </div>`;
        }
        
        function showError(message) {
            document.getElementById('content').innerHTML = `
                <div class="error-state">
                    <div class="icon">‚ö†Ô∏è</div>
                    <div class="title">Could not analyze ${currentSymbol}</div>
                    <div class="message">${message}</div>
                    <button class="retry-btn" onclick="loadOracle('${currentSymbol}')">Retry</button>
                </div>`;
        }
        
        async function loadOracle(symbol) {
            if (isLoading) return;
            isLoading = true;
            
            document.querySelectorAll('.token-btn').forEach(b => b.disabled = true);
            document.getElementById('content').innerHTML = `
                <div class="main-grid">
                    <div class="score-card"><div class="skeleton" style="height:280px"></div></div>
                    <div class="info-card"><div class="skeleton" style="height:280px"></div></div>
                </div>`;
            
            try {
                console.log('Loading Oracle for:', symbol);
                const response = await API.get('/oracle/score/' + symbol);
                console.log('Response:', response);
                
                const data = response.data || response;
                
                if (!data || !data.oracle_score) {
                    throw new Error('Invalid response from server');
                }
                
                renderOracle(data);
                document.getElementById('lastUpdated').textContent = 'Last updated: ' + new Date().toLocaleTimeString();
                
            } catch (err) {
                console.error('Oracle load error:', err);
                showError(err.message || 'Failed to load data');
            } finally {
                isLoading = false;
                document.querySelectorAll('.token-btn').forEach(b => b.disabled = false);
            }
        }
        
        function renderOracle(data) {
            const score = data.oracle_score || 50;
            const signal = (data.signal_type || 'hold').replace(/_/g, ' ').toUpperCase();
            const cls = score >= 55 ? 'bullish' : score <= 45 ? 'bearish' : 'neutral';
            const price = data.entry_price || 0;
            const priceChange = data.price_change_24h || 0;
            
            // Get top factors
            const factors = (data.factor_breakdown || []).slice(0, 6);
            
            document.getElementById('content').innerHTML = `
                <div class="main-grid">
                    <div class="score-card ${cls}">
                        <div class="score-label">ORACLE Score</div>
                        <div class="score-value ${cls}">${score}</div>
                        <div class="score-signal ${cls}">${signal}</div>
                        <div class="score-meta">
                            <div class="score-meta-item">
                                <div class="score-meta-label">Price</div>
                                <div class="score-meta-value">${Format.currency(price)}</div>
                            </div>
                            <div class="score-meta-item">
                                <div class="score-meta-label">24h Change</div>
                                <div class="score-meta-value ${priceChange >= 0 ? 'up' : 'down'}">${Format.percent(priceChange)}</div>
                            </div>
                            <div class="score-meta-item">
                                <div class="score-meta-label">Confidence</div>
                                <div class="score-meta-value">${(data.confidence || 'medium').toUpperCase()}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <div class="info-header">
                            <span class="info-title">üìä Factor Breakdown</span>
                            <span class="info-badge">${factors.length} Signals</span>
                        </div>
                        <div class="factor-list">
                            ${factors.map(f => `
                                <div class="factor-item">
                                    <span class="factor-name">${formatFactorName(f.name)}</span>
                                    <span class="factor-value ${getScoreClass(f.score)}">${f.score}/100</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                
                <div class="section-title">üéØ Trade Setup</div>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-icon">üìç</div>
                        <div class="metric-label">Entry Price</div>
                        <div class="metric-value">${Format.currency(data.entry_price)}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">üéØ</div>
                        <div class="metric-label">Target</div>
                        <div class="metric-value" style="color:#10b981">${Format.currency(data.target_price)}</div>
                        <div class="metric-sub">+${data.target_pct || 0}%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">üõë</div>
                        <div class="metric-label">Stop Loss</div>
                        <div class="metric-value" style="color:#ef4444">${Format.currency(data.stop_loss)}</div>
                        <div class="metric-sub">-${data.stop_pct || 0}%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">‚öñÔ∏è</div>
                        <div class="metric-label">Risk/Reward</div>
                        <div class="metric-value">${data.risk_reward_ratio || 1}:1</div>
                    </div>
                </div>
                
                <div class="reasoning-card">
                    <div class="reasoning-title">ü§ñ AI Analysis</div>
                    <div class="reasoning-text">${data.reasoning_summary || 'Analysis in progress...'}</div>
                    <div class="reasoning-bullets">
                        ${(data.reasoning_bullets || []).map(b => `<div class="reasoning-bullet">${b}</div>`).join('')}
                    </div>
                </div>
            `;
        }
        
        function formatFactorName(name) {
            return name.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
        }
        
        function getScoreClass(score) {
            if (score >= 60) return 'high';
            if (score >= 40) return 'medium';
            return 'low';
        }
    </script>
</body>
</html>
