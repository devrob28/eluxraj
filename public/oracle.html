<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORACLE v3.0 | ELUXRAJ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--bg:#050508;--card:#0d0d14;--card2:#12121a;--border:rgba(124,58,237,0.2);--border-light:rgba(255,255,255,0.06);--purple:#7c3aed;--cyan:#06b6d4;--green:#10b981;--red:#ef4444;--yellow:#f59e0b;--text:#fff;--text-muted:#9ca3af;--text-faint:#6b7280}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
        
        .header{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-bottom:1px solid var(--border);background:rgba(5,5,8,0.95);backdrop-filter:blur(10px);position:sticky;top:0;z-index:100}
        .logo{font-size:1.1rem;font-weight:900;background:linear-gradient(135deg,var(--purple),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .nav{display:flex;gap:6px}
        .nav a{padding:8px 16px;color:var(--text-muted);text-decoration:none;font-size:.85rem;font-weight:600;border-radius:8px;transition:all .2s}
        .nav a:hover{color:var(--text);background:rgba(255,255,255,0.05)}
        .nav a.active{color:var(--text);background:linear-gradient(135deg,rgba(124,58,237,0.2),rgba(6,182,212,0.1));border:1px solid var(--border)}
        
        .container{max-width:1400px;margin:0 auto;padding:24px}
        
        .version-badge{display:inline-flex;align-items:center;gap:6px;background:linear-gradient(135deg,rgba(124,58,237,0.2),rgba(6,182,212,0.1));border:1px solid var(--border);border-radius:20px;padding:6px 14px;font-size:.75rem;font-weight:700;color:var(--cyan);margin-bottom:16px}
        .version-badge .dot{width:6px;height:6px;background:var(--green);border-radius:50%;animation:pulse 2s infinite}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
        
        .token-bar{display:flex;gap:8px;margin-bottom:24px;flex-wrap:wrap}
        .token-btn{padding:10px 20px;background:var(--card);border:1px solid var(--border-light);border-radius:10px;color:var(--text-muted);font-size:.85rem;font-weight:600;cursor:pointer;transition:all .2s}
        .token-btn:hover{border-color:var(--purple);color:var(--text)}
        .token-btn.active{background:linear-gradient(135deg,var(--purple),var(--cyan));border-color:transparent;color:#fff}
        .token-btn:disabled{opacity:0.5;cursor:not-allowed}
        
        .main-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:24px}
        @media(max-width:1000px){.main-grid{grid-template-columns:1fr}}
        
        .score-card{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:32px;text-align:center;position:relative;overflow:hidden}
        .score-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--purple),var(--cyan))}
        .score-card.bullish{border-color:rgba(16,185,129,0.3)}
        .score-card.bullish::before{background:linear-gradient(90deg,var(--green),var(--cyan))}
        .score-card.bearish{border-color:rgba(239,68,68,0.3)}
        .score-card.bearish::before{background:linear-gradient(90deg,var(--red),var(--yellow))}
        .score-label{font-size:.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px}
        .score-value{font-family:'JetBrains Mono',monospace;font-size:4.5rem;font-weight:900;line-height:1;margin-bottom:8px}
        .score-value.bullish{background:linear-gradient(135deg,var(--green),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .score-value.bearish{background:linear-gradient(135deg,var(--red),var(--yellow));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .score-value.neutral{background:linear-gradient(135deg,var(--yellow),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .score-signal{display:inline-block;font-size:1rem;font-weight:800;text-transform:uppercase;padding:8px 20px;border-radius:8px;margin-bottom:16px}
        .score-signal.bullish{background:rgba(16,185,129,0.15);color:var(--green)}
        .score-signal.bearish{background:rgba(239,68,68,0.15);color:var(--red)}
        .score-signal.neutral{background:rgba(245,158,11,0.15);color:var(--yellow)}
        .score-meta{display:flex;justify-content:center;gap:24px;margin-top:16px}
        .score-meta-item{text-align:center}
        .score-meta-label{font-size:.65rem;color:var(--text-faint);text-transform:uppercase}
        .score-meta-value{font-family:'JetBrains Mono',monospace;font-size:1.1rem;font-weight:700}
        .score-meta-value.up{color:var(--green)}
        .score-meta-value.down{color:var(--red)}
        
        .quant-card{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:24px}
        .quant-header{display:flex;align-items:center;gap:10px;margin-bottom:20px}
        .quant-title{font-size:.85rem;font-weight:800;text-transform:uppercase;letter-spacing:1px;color:var(--cyan)}
        .quant-badge{font-size:.6rem;font-weight:700;padding:4px 8px;border-radius:4px;background:rgba(124,58,237,0.2);color:var(--purple)}
        .quant-signal{display:flex;align-items:center;justify-content:space-between;padding:16px;background:rgba(255,255,255,0.02);border-radius:12px;margin-bottom:16px}
        .quant-signal-label{font-size:.8rem;color:var(--text-muted)}
        .quant-signal-value{font-family:'JetBrains Mono',monospace;font-size:1.5rem;font-weight:800}
        .quant-insights{display:flex;flex-direction:column;gap:8px}
        .quant-insight{display:flex;align-items:flex-start;gap:10px;padding:10px 12px;background:rgba(124,58,237,0.05);border-radius:8px;font-size:.8rem;color:var(--text-muted)}
        .quant-insight-icon{font-size:14px;margin-top:2px}
        
        .section-title{font-size:.75rem;font-weight:800;text-transform:uppercase;letter-spacing:1.5px;color:var(--text-faint);margin-bottom:16px;display:flex;align-items:center;gap:8px}
        .section-title::after{content:'';flex:1;height:1px;background:var(--border-light)}
        
        .metrics-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:24px}
        @media(max-width:900px){.metrics-grid{grid-template-columns:repeat(2,1fr)}}
        .metric-card{background:var(--card);border:1px solid var(--border-light);border-radius:14px;padding:16px}
        .metric-icon{font-size:1.3rem;margin-bottom:6px}
        .metric-label{font-size:.65rem;color:var(--text-faint);text-transform:uppercase;letter-spacing:.5px;margin-bottom:2px}
        .metric-value{font-family:'JetBrains Mono',monospace;font-size:1.2rem;font-weight:700}
        .metric-sub{font-size:.7rem;color:var(--text-faint);margin-top:2px}
        
        .models-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:24px}
        @media(max-width:1100px){.models-grid{grid-template-columns:repeat(2,1fr)}}
        @media(max-width:700px){.models-grid{grid-template-columns:1fr}}
        .model-card{background:var(--card);border:1px solid var(--border-light);border-radius:16px;padding:20px;transition:all .2s}
        .model-card:hover{border-color:var(--purple)}
        .model-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}
        .model-name{font-size:.8rem;font-weight:700;color:var(--text)}
        .model-source{font-size:.6rem;color:var(--text-faint);margin-top:2px}
        .model-score{font-family:'JetBrains Mono',monospace;font-size:1.3rem;font-weight:800}
        .model-score.high{color:var(--green)}
        .model-score.medium{color:var(--yellow)}
        .model-score.low{color:var(--red)}
        .model-details{display:flex;flex-direction:column;gap:8px}
        .model-detail{display:flex;justify-content:space-between;font-size:.75rem}
        .model-detail-label{color:var(--text-faint)}
        .model-detail-value{font-family:'JetBrains Mono',monospace;color:var(--text-muted)}
        .model-signal{display:inline-block;font-size:.65rem;font-weight:700;padding:4px 8px;border-radius:4px;text-transform:uppercase;margin-top:8px}
        .model-signal.bullish{background:rgba(16,185,129,0.15);color:var(--green)}
        .model-signal.bearish{background:rgba(239,68,68,0.15);color:var(--red)}
        .model-signal.neutral{background:rgba(255,255,255,0.1);color:var(--text-muted)}
        
        .risk-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:24px}
        @media(max-width:800px){.risk-grid{grid-template-columns:1fr}}
        .risk-card{background:var(--card);border:1px solid var(--border-light);border-radius:16px;padding:20px}
        .risk-header{display:flex;align-items:center;gap:8px;margin-bottom:12px}
        .risk-icon{font-size:1.2rem}
        .risk-title{font-size:.8rem;font-weight:700}
        .risk-value{font-family:'JetBrains Mono',monospace;font-size:2rem;font-weight:900;margin-bottom:4px}
        .risk-value.excellent{color:var(--green)}
        .risk-value.good{color:var(--cyan)}
        .risk-value.average{color:var(--yellow)}
        .risk-value.poor{color:var(--red)}
        .risk-label{font-size:.7rem;color:var(--text-faint)}
        
        .components-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-bottom:24px}
        @media(max-width:800px){.components-grid{grid-template-columns:1fr}}
        .component-card{background:var(--card);border:1px solid var(--border-light);border-radius:14px;padding:18px}
        .component-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
        .component-name{font-size:.8rem;font-weight:700}
        .component-score{font-family:'JetBrains Mono',monospace;font-size:1.1rem;font-weight:800}
        .component-bar{height:8px;background:rgba(255,255,255,0.05);border-radius:4px;overflow:hidden}
        .component-bar-fill{height:100%;border-radius:4px;transition:width .5s}
        .component-bar-fill.high{background:linear-gradient(90deg,var(--green),var(--cyan))}
        .component-bar-fill.medium{background:linear-gradient(90deg,var(--yellow),var(--green))}
        .component-bar-fill.low{background:linear-gradient(90deg,var(--red),var(--yellow))}
        .component-desc{font-size:.7rem;color:var(--text-faint);margin-top:8px}
        
        .reasoning-card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px;margin-bottom:24px}
        .reasoning-title{font-size:.8rem;font-weight:800;text-transform:uppercase;letter-spacing:1px;color:var(--cyan);margin-bottom:16px}
        .reasoning-summary{font-size:1rem;font-weight:600;margin-bottom:16px;line-height:1.5}
        .reasoning-bullets{display:flex;flex-direction:column;gap:10px}
        .reasoning-bullet{display:flex;align-items:flex-start;gap:10px;font-size:.85rem;color:var(--text-muted)}
        .reasoning-bullet-icon{color:var(--cyan)}
        
        .skeleton{background:linear-gradient(90deg,var(--card) 25%,rgba(124,58,237,0.1) 50%,var(--card) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:8px}
        @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
        
        .error-state{text-align:center;padding:60px 20px}
        .error-state .icon{font-size:3rem;margin-bottom:16px}
        .error-state .message{color:var(--text-muted);margin-bottom:16px}
        .error-state .retry-btn{padding:12px 24px;background:var(--purple);border:none;border-radius:10px;color:#fff;font-weight:600;cursor:pointer}
        
        .last-updated{text-align:center;padding:16px;color:var(--text-faint);font-size:.75rem}
        
        .disclaimer{background:rgba(239,68,68,0.05);border:1px solid rgba(239,68,68,0.2);border-radius:12px;padding:16px;font-size:.75rem;color:var(--text-faint);margin-top:24px}
        .disclaimer strong{color:var(--red)}
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">ELUXRAJ‚Ñ¢</div>
        <nav class="nav">
            <a href="/dashboard.html">Dashboard</a>
            <a href="/oracle.html" class="active">Oracle</a>
            <a href="/whale-intel.html">Gotham Intel</a>
            <a href="/chart-analysis.html">Chart AI</a>
        </nav>
    </header>
    
    <main class="container">
        <div class="version-badge">
            <span class="dot"></span>
            ORACLE v3.0 ‚Äî Institutional Grade
        </div>
        
        <div class="token-bar" id="tokenBar">
            <button class="token-btn active" data-symbol="BTC">‚Çø Bitcoin</button>
            <button class="token-btn" data-symbol="ETH">Œû Ethereum</button>
            <button class="token-btn" data-symbol="SOL">‚óé Solana</button>
            <button class="token-btn" data-symbol="BNB">BNB</button>
            <button class="token-btn" data-symbol="XRP">XRP</button>
            <button class="token-btn" data-symbol="DOGE">DOGE</button>
        </div>
        
        <div id="content">
            <div class="main-grid">
                <div class="score-card"><div class="skeleton" style="height:250px"></div></div>
                <div class="quant-card"><div class="skeleton" style="height:250px"></div></div>
            </div>
        </div>
        
        <div class="last-updated" id="lastUpdated"></div>
        
        <div class="disclaimer">
            <strong>‚ö†Ô∏è Not Financial Advice:</strong> ORACLE signals are for informational purposes only. Past performance does not guarantee future results. Always do your own research and consult a financial advisor.
        </div>
    </main>
    
    <script src="/js/eluxraj-utils.js"></script>
    <script>
        let currentSymbol = 'BTC';
        let isLoading = false;
        
        (async () => {
            const user = await Auth.check();
            if (!user) return;
            
            if (user.subscription_tier === 'free') {
                document.getElementById('content').innerHTML = '<div class="error-state"><div class="icon">üîí</div><div class="message">ORACLE v3.0 requires Elite subscription</div><a href="/pricing.html" class="retry-btn">Upgrade to Elite ‚Äî $98/mo</a></div>';
                return;
            }
            
            loadOracle(currentSymbol);
        })();
        
        document.getElementById('tokenBar').onclick = (e) => {
            if (e.target.classList.contains('token-btn') && !isLoading) {
                document.querySelectorAll('.token-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                currentSymbol = e.target.dataset.symbol;
                loadOracle(currentSymbol);
            }
        };
        
        async function loadOracle(symbol) {
            if (isLoading) return;
            isLoading = true;
            
            document.querySelectorAll('.token-btn').forEach(b => b.disabled = true);
            document.getElementById('content').innerHTML = '<div class="main-grid"><div class="score-card"><div class="skeleton" style="height:250px"></div></div><div class="quant-card"><div class="skeleton" style="height:250px"></div></div></div>';
            
            try {
                const response = await API.get("/oracle/score/" + symbol);
                const data = response.data || response;
                renderOracle(data);
                document.getElementById('lastUpdated').textContent = 'Last updated: ' + new Date().toLocaleTimeString();
            } catch (err) {
                document.getElementById('content').innerHTML = '<div class="error-state"><div class="icon">‚ö†Ô∏è</div><div class="message">' + err.message + '</div><button class="retry-btn" onclick="loadOracle(\'' + symbol + '\')">Retry</button></div>';
            } finally {
                isLoading = false;
                document.querySelectorAll('.token-btn').forEach(b => b.disabled = false);
            }
        }
        
        function renderOracle(data) {
            const score = data.oracle_score;
            const signal = (data.signal_type || 'hold').replace(/_/g, ' ').toUpperCase();
            const cls = score >= 55 ? 'bullish' : score <= 45 ? 'bearish' : 'neutral';
            
            const quant = data.quant_models || {};
            const detailed = data.detailed_models || {};
            const components = data.components || {};
            const price = data.price || data.entry_price || 0;
            const priceChange = data.price_change_24h || 0;
            
            document.getElementById('content').innerHTML = 
                '<div class="main-grid">' +
                    '<div class="score-card ' + cls + '">' +
                        '<div class="score-label">ORACLE Score</div>' +
                        '<div class="score-value ' + cls + '">' + score + '</div>' +
                        '<div class="score-signal ' + cls + '">' + signal + '</div>' +
                        '<div class="score-meta">' +
                            '<div class="score-meta-item"><div class="score-meta-label">Price</div><div class="score-meta-value">' + Format.currency(price) + '</div></div>' +
                            '<div class="score-meta-item"><div class="score-meta-label">24h</div><div class="score-meta-value ' + (priceChange >= 0 ? 'up' : 'down') + '">' + Format.percent(priceChange) + '</div></div>' +
                            '<div class="score-meta-item"><div class="score-meta-label">Confidence</div><div class="score-meta-value">' + (data.confidence || 'medium').toUpperCase() + '</div></div>' +
                        '</div>' +
                    '</div>' +
                    '<div class="quant-card">' +
                        '<div class="quant-header"><span class="quant-title">üèõÔ∏è Institutional Models</span><span class="quant-badge">' + (quant.models_used || 11) + ' Models</span></div>' +
                        '<div class="quant-signal"><div class="quant-signal-label">Quant Signal</div><div class="quant-signal-value" style="color:' + getSignalColor(quant.signal) + '">' + (quant.signal || 'HOLD') + '</div></div>' +
                        '<div class="quant-insights">' + renderInsights(quant.key_insights || []) + '</div>' +
                    '</div>' +
                '</div>' +
                '<div class="section-title">üìâ Risk Metrics (Goldman Sachs Style)</div>' +
                '<div class="risk-grid">' +
                    renderRiskCard('Sharpe Ratio', detailed.risk_metrics?.sharpe?.sharpe_ratio, detailed.risk_metrics?.sharpe?.quality, 'Risk-adjusted returns') +
                    renderRiskCard('Sortino Ratio', detailed.risk_metrics?.sortino?.sortino_ratio, null, 'Downside risk adjusted') +
                    renderRiskCard('VaR 95%', detailed.risk_metrics?.var?.var_95 ? detailed.risk_metrics.var.var_95 + '%' : '--', detailed.risk_metrics?.var?.risk_level, 'Max daily loss') +
                '</div>' +
                '<div class="section-title">üßÆ Quantitative Models</div>' +
                '<div class="models-grid">' +
                    renderModelCard('Time-Series Momentum', 'AQR Capital', detailed.momentum_tsmom) +
                    renderModelCard('Mean Reversion', 'Two Sigma', detailed.mean_reversion) +
                    renderModelCard('Trend Following', 'CTA Style', detailed.trend) +
                    renderModelCard('Volume Analysis', 'Microstructure', detailed.volume) +
                '</div>' +
                '<div class="section-title">‚õìÔ∏è On-Chain Intelligence</div>' +
                '<div class="components-grid">' +
                    renderComponent('Whale Activity', components.whale_score, 'üêã', 'Large holder activity') +
                    renderComponent('Technical Score', components.technical_score, 'üìä', 'RSI, MACD, MA') +
                    renderComponent('Market Sentiment', components.sentiment_score, 'üí¨', 'Fear & Greed') +
                    renderComponent('Liquidation Risk', components.liquidation_risk, '‚ö†Ô∏è', 'Leverage levels') +
                '</div>' +
                '<div class="reasoning-card">' +
                    '<div class="reasoning-title">ü§ñ AI Analysis</div>' +
                    '<div class="reasoning-summary">' + (data.reasoning_summary || data.reasoning || 'Analysis complete.') + '</div>' +
                    '<div class="reasoning-bullets">' + renderBullets(data.reasoning_bullets || []) + '</div>' +
                '</div>' +
                '<div class="section-title">üéØ Trade Setup</div>' +
                '<div class="metrics-grid">' +
                    '<div class="metric-card"><div class="metric-icon">üìç</div><div class="metric-label">Entry</div><div class="metric-value">' + Format.currency(data.entry_price) + '</div></div>' +
                    '<div class="metric-card"><div class="metric-icon">üéØ</div><div class="metric-label">Target</div><div class="metric-value" style="color:var(--green)">' + Format.currency(data.target_price) + '</div><div class="metric-sub">+' + (data.target_pct || 0) + '%</div></div>' +
                    '<div class="metric-card"><div class="metric-icon">üõë</div><div class="metric-label">Stop Loss</div><div class="metric-value" style="color:var(--red)">' + Format.currency(data.stop_loss) + '</div><div class="metric-sub">-' + (data.stop_pct || 0) + '%</div></div>' +
                    '<div class="metric-card"><div class="metric-icon">‚öñÔ∏è</div><div class="metric-label">Risk/Reward</div><div class="metric-value">' + (data.risk_reward_ratio || 1) + ':1</div></div>' +
                '</div>';
        }
        
        function renderInsights(insights) {
            return insights.slice(0, 4).map(function(i) {
                return '<div class="quant-insight"><span class="quant-insight-icon">üìä</span><span>' + i + '</span></div>';
            }).join('');
        }
        
        function renderBullets(bullets) {
            return bullets.map(function(b) {
                return '<div class="reasoning-bullet"><span class="reasoning-bullet-icon">‚Üí</span><span>' + b + '</span></div>';
            }).join('');
        }
        
        function renderRiskCard(title, value, quality, desc) {
            var displayValue = value !== undefined && value !== null ? value : '--';
            var colorClass = getQualityClass(value, quality);
            return '<div class="risk-card"><div class="risk-header"><span class="risk-icon">üìà</span><span class="risk-title">' + title + '</span></div><div class="risk-value ' + colorClass + '">' + displayValue + '</div><div class="risk-label">' + desc + '</div></div>';
        }
        
        function renderModelCard(name, source, data) {
            if (!data) {
                return '<div class="model-card"><div class="model-header"><div><div class="model-name">' + name + '</div><div class="model-source">' + source + '</div></div><div class="model-score medium">--</div></div><div class="model-details"><div class="model-detail"><span class="model-detail-label">No data</span></div></div></div>';
            }
            var score = data.score || 50;
            var scoreClass = score >= 60 ? 'high' : score <= 40 ? 'low' : 'medium';
            var signal = data.signal || data.crossover || 'neutral';
            var signalClass = signal.includes('buy') || signal.includes('bullish') ? 'bullish' : signal.includes('sell') || signal.includes('bearish') ? 'bearish' : 'neutral';
            return '<div class="model-card"><div class="model-header"><div><div class="model-name">' + name + '</div><div class="model-source">' + source + '</div></div><div class="model-score ' + scoreClass + '">' + score + '</div></div><div class="model-signal ' + signalClass + '">' + signal.replace(/_/g, ' ') + '</div></div>';
        }
        
        function renderComponent(name, score, icon, desc) {
            var s = score || 50;
            var cls = s >= 60 ? 'high' : s <= 40 ? 'low' : 'medium';
            var color = s >= 60 ? 'var(--green)' : s <= 40 ? 'var(--red)' : 'var(--yellow)';
            return '<div class="component-card"><div class="component-header"><span class="component-name">' + icon + ' ' + name + '</span><span class="component-score" style="color:' + color + '">' + s + '/100</span></div><div class="component-bar"><div class="component-bar-fill ' + cls + '" style="width:' + s + '%"></div></div><div class="component-desc">' + desc + '</div></div>';
        }
        
        function getSignalColor(signal) {
            if (!signal) return 'var(--text-muted)';
            if (signal.includes('BUY')) return 'var(--green)';
            if (signal.includes('SELL')) return 'var(--red)';
            return 'var(--yellow)';
        }
        
        function getQualityClass(value, quality) {
            if (quality === 'excellent' || value >= 2) return 'excellent';
            if (quality === 'good' || value >= 1) return 'good';
            if (quality === 'poor' || value < 0) return 'poor';
            return 'average';
        }
    </script>
</body>
</html>
