<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ELUXRAJ‚Ñ¢</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0a0f;--card:rgba(255,255,255,0.03);--border:rgba(255,255,255,0.08);--text:#fff;--muted:rgba(255,255,255,0.5);--accent:#6366f1;--green:#10b981;--red:#ef4444;--gold:#f59e0b}
body{font-family:system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
nav{position:fixed;top:0;left:0;right:0;height:60px;background:rgba(10,10,15,0.95);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 20px;z-index:100}
.logo{font-size:20px;font-weight:800;color:var(--accent)}
.user{display:flex;align-items:center;gap:8px;padding:6px 12px;background:var(--card);border:1px solid var(--border);border-radius:20px;font-size:13px}
main{padding:80px 20px 20px;max-width:1200px;margin:0 auto}
.hero{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center}
.hero h1{font-size:24px}.hero h1 span{color:var(--accent)}.hero p{color:var(--muted);font-size:14px}
.pval{text-align:right}.pval-amt{font-size:32px;font-weight:700}.pval-chg{color:var(--green);font-size:13px}
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px}
.stat{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px}
.stat-label{font-size:11px;color:var(--muted);margin-bottom:6px}
.stat-value{font-size:20px;font-weight:700}
.stat-value.up{color:var(--green)}.stat-value.down{color:var(--red)}
.stat-sub{font-size:11px;color:var(--muted);margin-top:4px}
.actions{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px}
.action{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;text-align:center;cursor:pointer;transition:all 0.2s}
.action:hover{border-color:var(--accent);transform:translateY(-2px)}
.action .icon{font-size:28px;margin-bottom:10px}
.action h4{font-size:14px;margin-bottom:4px}.action p{font-size:11px;color:var(--muted)}
.ai-box{background:linear-gradient(135deg,rgba(99,102,241,0.1),rgba(139,92,246,0.1));border:1px solid rgba(99,102,241,0.3);border-radius:16px;padding:20px;margin-bottom:20px}
.ai-row{display:flex;gap:10px;margin-bottom:12px;align-items:center}
.ai-avatar{width:40px;height:40px;background:linear-gradient(135deg,#6366f1,#ec4899);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px}
.ai-title{font-weight:600}.ai-sub{font-size:12px;color:var(--muted)}
.ai-input{flex:1;padding:12px 16px;background:rgba(0,0,0,0.3);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:14px}
.ai-input:focus{outline:none;border-color:var(--accent)}
.ai-btn{padding:12px 20px;background:var(--accent);border:none;border-radius:10px;color:#fff;font-weight:600;cursor:pointer}
.chips{display:flex;gap:8px;flex-wrap:wrap}
.chip{padding:6px 12px;background:var(--card);border:1px solid var(--border);border-radius:16px;font-size:11px;color:var(--muted);cursor:pointer}
.chip:hover{border-color:var(--accent);color:var(--text)}
.ai-response{margin-top:16px;padding:16px;background:rgba(0,0,0,0.3);border-radius:10px;display:none;line-height:1.7;max-height:400px;overflow-y:auto}
.ai-response.active{display:block}
.grid{display:grid;grid-template-columns:2fr 1fr;gap:20px}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden}
.card-head{padding:16px;border-bottom:1px solid var(--border);font-weight:600;font-size:14px}
.card-body{padding:16px}
.tools{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.tool{background:rgba(0,0,0,0.2);border:1px solid var(--border);border-radius:10px;padding:16px;cursor:pointer;transition:all 0.2s}
.tool:hover{border-color:var(--accent)}
.tool .icon{font-size:20px;margin-bottom:8px}
.tool h4{font-size:13px;margin-bottom:4px}.tool p{font-size:11px;color:var(--muted)}
.mkt{padding:12px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
.mkt:last-child{border:none}
.mkt-name{font-weight:600;font-size:13px}
.mkt-price{font-weight:600;font-size:13px}
.mkt-chg{font-size:12px}.mkt-chg.up{color:var(--green)}.mkt-chg.down{color:var(--red)}
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:200;display:none;align-items:center;justify-content:center;padding:20px}
.modal-bg.active{display:flex}
.modal{background:#111;border:1px solid var(--border);border-radius:16px;width:100%;max-width:500px;max-height:80vh;overflow:hidden}
.modal-head{padding:20px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
.modal-title{font-weight:700;font-size:18px}
.modal-close{background:var(--card);border:1px solid var(--border);width:32px;height:32px;border-radius:8px;cursor:pointer;color:var(--muted);font-size:18px}
.modal-body{padding:20px;overflow-y:auto;max-height:calc(80vh - 80px)}
.form-group{margin-bottom:16px}
.form-label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
.form-input,.form-select{width:100%;padding:12px;background:var(--card);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:14px}
.form-input:focus,.form-select:focus{outline:none;border-color:var(--accent)}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.btn{width:100%;padding:14px;background:var(--accent);border:none;border-radius:10px;color:#fff;font-weight:600;cursor:pointer;font-size:14px}
.results{margin-top:16px;padding:16px;background:var(--card);border-radius:10px;display:none;line-height:1.7;max-height:300px;overflow-y:auto}
.results.active{display:block}
.loading{text-align:center;padding:20px}
.spinner{width:30px;height:30px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto}
@keyframes spin{to{transform:rotate(360deg)}}
@media(max-width:900px){.grid{grid-template-columns:1fr}.stats,.actions{grid-template-columns:repeat(2,1fr)}.hero{flex-direction:column;text-align:center;gap:16px}.pval{text-align:center}}
</style>
<script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script></head>
<body>
<nav><div class="logo">ELUXRAJ</div><div class="user"><span id="userName">Rob</span> <span style="color:var(--gold)">ELITE</span></div></nav>
<main>
<section class="hero"><div><h1>Welcome, <span id="heroName">Rob</span> üëã</h1><p>AI wealth intelligence ready</p></div><div style="display:flex;gap:15px;align-items:center"><button onclick="connectBrokerage()" style="padding:12px 20px;background:var(--accent);border:none;border-radius:10px;color:#fff;font-weight:600;cursor:pointer">üîó Connect Brokerage</button></div><div class="pval"><div class="pval-amt">$127,482</div><div class="pval-chg">‚Üë +6.9% this month</div></div></section>
<section class="stats">
<div class="stat"><div class="stat-label">‚Çø BTC 24h</div><div class="stat-value up" id="sBtc">+3.9%</div><div class="stat-sub" id="pBtc">$91,365</div></div>
<div class="stat"><div class="stat-label">üìà S&P 500</div><div class="stat-value up" id="sSpy">+0.34%</div><div class="stat-sub" id="pSpy">$598</div></div>
<div class="stat"><div class="stat-label">ü•á Gold</div><div class="stat-value down" id="sGold">-0.22%</div><div class="stat-sub" id="pGold">$4,158</div></div>
<div class="stat"><div class="stat-label">üò± Fear/Greed</div><div class="stat-value">76</div><div class="stat-sub">Extreme Greed</div></div>
</section>
<section class="actions">
<div class="action" onclick="openModal('wizard')"><div class="icon">üßô</div><h4>Portfolio Wizard</h4><p>AI allocation</p></div>
<div class="action" onclick="openModal('scanner')"><div class="icon">üîç</div><h4>Market Scanner</h4><p>Find opportunities</p></div>
<div class="action" onclick="openModal('signal')"><div class="icon">üìä</div><h4>Trading Signals</h4><p>Entry & exit</p></div>
<div class="action" onclick="openModal('calc')"><div class="icon">üßÆ</div><h4>Position Sizer</h4><p>Risk management</p></div>
</section>
<section class="ai-box">
<div class="ai-row"><div class="ai-avatar">ü§ñ</div><div><div class="ai-title">ELUXRAJ AI</div><div class="ai-sub">Trained on top hedge fund strategies</div></div></div>
<div class="ai-row"><input class="ai-input" id="aiQ" placeholder="Ask anything... 'Should I buy NVDA?'" onkeypress="if(event.key==='Enter')ask()"><button class="ai-btn" onclick="ask()">Ask ‚Üí</button></div>
<div class="chips">
<span class="chip" onclick="qAsk('Build me a $50K portfolio')">üíº Portfolio</span>
<span class="chip" onclick="qAsk('Top 5 stocks to buy')">üìà Stocks</span>
<span class="chip" onclick="qAsk('Analyze BTC')">‚Çø BTC</span>
<span class="chip" onclick="qAsk('NVDA signal')">üìä NVDA</span>
<span class="chip" onclick="qAsk('Crypto allocation $10K')">ü™ô Crypto</span>
</div>
<div class="ai-response" id="aiR"></div>
</section>
<div class="grid">
<div class="card"><div class="card-head">üõ†Ô∏è Pro Tools</div><div class="card-body"><div class="tools">
<div class="tool" onclick="openModal('wizard')"><div class="icon">üßô</div><h4>Portfolio Wizard</h4><p>AI allocation</p></div>
<div class="tool" onclick="openModal('stocks')"><div class="icon">üìà</div><h4>Stock Picks</h4><p>Hedge fund style</p></div>
<div class="tool" onclick="openModal('crypto')"><div class="icon">‚Çø</div><h4>Crypto Builder</h4><p>Optimal allocation</p></div>
<div class="tool" onclick="openModal('scanner')"><div class="icon">üîç</div><h4>Scanner</h4><p>Find trades</p></div>
<div class="tool" onclick="openModal('fund')"><div class="icon">üè¶</div><h4>Fund Strategies</h4><p>Learn from pros</p></div>
<div class="tool" onclick="openModal('compare')"><div class="icon">‚öñÔ∏è</div><h4>Compare</h4><p>Side by side</p></div>
</div></div></div>
<div class="card"><div class="card-head">üìä Markets</div><div class="card-body">
<div class="mkt"><span class="mkt-name">BTC</span><span><span class="mkt-price" id="mBtc">$91,365</span> <span class="mkt-chg up" id="cBtc">+3.9%</span></span></div>
<div class="mkt"><span class="mkt-name">ETH</span><span><span class="mkt-price" id="mEth">$3,029</span> <span class="mkt-chg up" id="cEth">+2.9%</span></span></div>
<div class="mkt"><span class="mkt-name">GOLD</span><span><span class="mkt-price" id="mGold">$4,158</span> <span class="mkt-chg down" id="cGold">-0.2%</span></span></div>
<div class="mkt"><span class="mkt-name">SPY</span><span><span class="mkt-price" id="mSpy">$598</span> <span class="mkt-chg up" id="cSpy">+0.3%</span></span></div>
</div></div>
</div>
</main>
<div class="modal-bg" id="modalBg" onclick="closeModal(event)">
<div class="modal" onclick="event.stopPropagation()">
<div class="modal-head"><span class="modal-title" id="mTitle">Tool</span><button class="modal-close" onclick="closeModal()">‚úï</button></div>
<div class="modal-body" id="mBody"></div>
</div>
</div>
<script>
const token=localStorage.getItem('eluxraj_token'),user=JSON.parse(localStorage.getItem('eluxraj_user')||'{}');
if(!token)window.location.href='/login.html';
const n=user.name||'Investor';document.getElementById('userName').textContent=n;document.getElementById('heroName').textContent=n;
async function api(u,d,m='POST'){const o={method:m,headers:{'Authorization':'Bearer '+token}};if(m==='POST'&&d){o.headers['Content-Type']='application/json';o.body=JSON.stringify(d)}return(await fetch(u,o)).json()}
function fmt(t){return t.replace(/### (.*)/g,'<h3 style="color:var(--accent);margin:12px 0 8px">$1</h3>').replace(/## (.*)/g,'<h2 style="color:var(--accent);margin:12px 0 8px">$1</h2>').replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\n/g,'<br>')}
async function ask(){const q=document.getElementById('aiQ').value.trim(),r=document.getElementById('aiR');if(!q)return;r.classList.add('active');r.innerHTML='<div class="loading"><div class="spinner"></div></div>';const x=await api('/api/ai/analyze',{query:q});r.innerHTML=x.ok?fmt(x.analysis):'Error: '+x.error}
function qAsk(q){document.getElementById('aiQ').value=q;ask()}
const M={wizard:{t:'üßô Portfolio Wizard',h:'<div class="form-group"><label class="form-label">üí∞ Amount ($)</label><input class="form-input" id="wAmt" value="50000" type="number"></div><div class="form-row"><div class="form-group"><label class="form-label">‚è±Ô∏è Time</label><select class="form-select" id="wTime"><option>1-2 yrs</option><option>3-5 yrs</option><option selected>5-10 yrs</option><option>10+ yrs</option></select></div><div class="form-group"><label class="form-label">‚ö° Risk (1-10)</label><input class="form-input" id="wRisk" type="number" value="5" min="1" max="10"></div></div><div class="form-group"><label class="form-label">üéØ Goals</label><input class="form-input" id="wGoal" value="Wealth building"></div><button class="btn" onclick="runWiz()">‚ú® Build Portfolio</button><div class="results" id="wR"></div>'},stocks:{t:'üìà Stock Picks',h:'<div class="form-row"><div class="form-group"><label class="form-label">Sector</label><select class="form-select" id="sSec"><option>Technology</option><option>Healthcare</option><option>Financials</option><option>All</option></select></div><div class="form-group"><label class="form-label">Risk</label><select class="form-select" id="sRisk"><option>Conservative</option><option selected>Moderate</option><option>Aggressive</option></select></div></div><button class="btn" onclick="runStocks()">Get Picks</button><div class="results" id="sR"></div>'},crypto:{t:'‚Çø Crypto Portfolio',h:'<div class="form-row"><div class="form-group"><label class="form-label">Amount ($)</label><input class="form-input" id="cAmt" value="10000" type="number"></div><div class="form-group"><label class="form-label">Risk</label><select class="form-select" id="cRisk"><option>Low</option><option selected>Moderate</option><option>High</option></select></div></div><button class="btn" onclick="runCrypto()">Build</button><div class="results" id="cR"></div>'},scanner:{t:'üîç Market Scanner',h:'<div class="form-row"><div class="form-group"><label class="form-label">Type</label><select class="form-select" id="scType"><option value="oversold">Oversold</option><option value="breakout">Breakout</option><option value="momentum">Momentum</option></select></div><div class="form-group"><label class="form-label">Sector</label><select class="form-select" id="scSec"><option>All</option><option>Tech</option><option>Healthcare</option></select></div></div><button class="btn" onclick="runScan()">üîç Scan</button><div class="results" id="scR"></div>'},signal:{t:'üìä Trading Signal',h:'<div class="form-row"><div class="form-group"><label class="form-label">Symbol</label><input class="form-input" id="sigSym" value="NVDA"></div><div class="form-group"><label class="form-label">Strategy</label><select class="form-select" id="sigStr"><option value="swing">Swing</option><option value="day">Day</option><option value="position">Position</option></select></div></div><button class="btn" onclick="runSig()">Get Signal</button><div class="results" id="sigR"></div>'},fund:{t:'üè¶ Hedge Fund Strategies',h:'<div class="form-group"><label class="form-label">Fund</label><select class="form-select" id="fundSel"><option>Renaissance Technologies</option><option>Citadel</option><option>Millennium</option><option>Bridgewater</option><option>Two Sigma</option></select></div><button class="btn" onclick="runFund()">Learn</button><div class="results" id="fundR"></div>'},compare:{t:'‚öñÔ∏è Compare Assets',h:'<div class="form-row"><div class="form-group"><label class="form-label">Asset 1</label><input class="form-input" id="cmp1" value="AAPL"></div><div class="form-group"><label class="form-label">Asset 2</label><input class="form-input" id="cmp2" value="MSFT"></div></div><button class="btn" onclick="runCmp()">Compare</button><div class="results" id="cmpR"></div>'},calc:{t:'üßÆ Position Sizer',h:'<div class="form-row"><div class="form-group"><label class="form-label">Account ($)</label><input class="form-input" id="acct" value="50000" type="number"></div><div class="form-group"><label class="form-label">Risk %</label><input class="form-input" id="riskPct" value="2" type="number" step="0.5"></div></div><div class="form-row"><div class="form-group"><label class="form-label">Entry ($)</label><input class="form-input" id="entry" value="100" type="number"></div><div class="form-group"><label class="form-label">Stop ($)</label><input class="form-input" id="stop" value="95" type="number"></div></div><button class="btn" onclick="runCalc()">Calculate</button><div class="results active" id="calcR" style="text-align:center"><div style="font-size:28px;font-weight:700" id="calcShares">200 shares</div><div style="color:var(--muted)" id="calcVal">$20,000 | Risk: $1,000</div></div>'}};
function openModal(k){const m=M[k];if(!m)return;document.getElementById('mTitle').textContent=m.t;document.getElementById('mBody').innerHTML=m.h;document.getElementById('modalBg').classList.add('active')}
function closeModal(e){if(!e||e.target.id==='modalBg')document.getElementById('modalBg').classList.remove('active')}
async function runWiz(){const b=document.getElementById('wR');b.classList.add('active');b.innerHTML='<div class="loading"><div class="spinner"></div></div>';const r=await api('/api/ai/portfolio-wizard',{portfolioValue:+document.getElementById('wAmt').value,riskTolerance:+document.getElementById('wRisk').value,timeHorizon:document.getElementById('wTime').value,goals:document.getElementById('wGoal').value});b.innerHTML=r.ok?fmt(r.analysis):'Error'}
async function runStocks(){const b=document.getElementById('sR');b.classList.add('active');b.innerHTML='<div class="loading"><div class="spinner"></div></div>';const r=await api('/api/ai/stock-picks',{sector:document.getElementById('sSec').value,count:5,riskLevel:document.getElementById('sRisk').value});b.innerHTML=r.ok?fmt(r.analysis):'Error'}
async function runCrypto(){const b=document.getElementById('cR');b.classList.add('active');b.innerHTML='<div class="loading"><div class="spinner"></div></div>';const r=await api('/api/ai/crypto-allocation',{totalCryptoInvestment:+document.getElementById('cAmt').value,riskTolerance:document.getElementById('cRisk').value,experience:'Intermediate'});b.innerHTML=r.ok?fmt(r.analysis):'Error'}
async function runScan(){const b=document.getElementById('scR');b.classList.add('active');b.innerHTML='<div class="loading"><div class="spinner"></div></div>';const r=await api('/api/ai/analyze',{query:'Run '+document.getElementById('scType').value+' scan for '+document.getElementById('scSec').value+'. Give 5 tickers with entry, stop, target.'});b.innerHTML=r.ok?fmt(r.analysis):'Error'}
async function runSig(){const b=document.getElementById('sigR');b.classList.add('active');b.innerHTML='<div class="loading"><div class="spinner"></div></div>';const r=await api('/api/ai/signal/'+document.getElementById('sigSym').value.toUpperCase()+'?strategy='+document.getElementById('sigStr').value,null,'GET');b.innerHTML=r.ok?fmt(r.analysis):'Error'}
async function runFund(){const b=document.getElementById('fundR');b.classList.add('active');b.innerHTML='<div class="loading"><div class="spinner"></div></div>';const r=await api('/api/ai/hedge-fund/'+encodeURIComponent(document.getElementById('fundSel').value),null,'GET');b.innerHTML=r.ok?fmt(r.analysis):'Error'}
async function runCmp(){const b=document.getElementById('cmpR');b.classList.add('active');b.innerHTML='<div class="loading"><div class="spinner"></div></div>';const r=await api('/api/ai/compare?asset1='+document.getElementById('cmp1').value+'&asset2='+document.getElementById('cmp2').value,null,'GET');b.innerHTML=r.ok?fmt(r.analysis):'Error'}
function runCalc(){const a=+document.getElementById('acct').value,rp=+document.getElementById('riskPct').value/100,e=+document.getElementById('entry').value,s=+document.getElementById('stop').value,risk=a*rp,perShare=Math.abs(e-s),shares=Math.floor(risk/perShare);document.getElementById('calcShares').textContent=shares+' shares';document.getElementById('calcVal').textContent='$'+(shares*e).toLocaleString()+' | Risk: $'+risk.toFixed(0)}
async function loadPrices(){try{const r=await fetch('/api/oracle/all'),d=await r.json();if(d.ok&&d.data){if(d.data.crypto?.BTC){const p=d.data.crypto.BTC.price,c=d.data.crypto.BTC.change24h;document.getElementById('pBtc').textContent='$'+Math.round(p).toLocaleString();document.getElementById('sBtc').textContent=(c>=0?'+':'')+c.toFixed(1)+'%';document.getElementById('sBtc').className='stat-value '+(c>=0?'up':'down');document.getElementById('mBtc').textContent='$'+Math.round(p).toLocaleString();document.getElementById('cBtc').textContent=(c>=0?'+':'')+c.toFixed(1)+'%';document.getElementById('cBtc').className='mkt-chg '+(c>=0?'up':'down')}if(d.data.crypto?.ETH){const p=d.data.crypto.ETH.price,c=d.data.crypto.ETH.change24h;document.getElementById('mEth').textContent='$'+Math.round(p).toLocaleString();document.getElementById('cEth').textContent=(c>=0?'+':'')+c.toFixed(1)+'%';document.getElementById('cEth').className='mkt-chg '+(c>=0?'up':'down')}if(d.data.metals?.GOLD){const p=d.data.metals.GOLD.price,c=d.data.metals.GOLD.change24h;document.getElementById('pGold').textContent='$'+Math.round(p).toLocaleString();document.getElementById('sGold').textContent=(c>=0?'+':'')+c.toFixed(1)+'%';document.getElementById('sGold').className='stat-value '+(c>=0?'up':'down');document.getElementById('mGold').textContent='$'+Math.round(p).toLocaleString();document.getElementById('cGold').textContent=(c>=0?'+':'')+c.toFixed(1)+'%';document.getElementById('cGold').className='mkt-chg '+(c>=0?'up':'down')}if(d.data.etfs?.SPY){const p=d.data.etfs.SPY.price,c=d.data.etfs.SPY.change24h;document.getElementById('pSpy').textContent='$'+p.toFixed(0);document.getElementById('sSpy').textContent=(c>=0?'+':'')+c.toFixed(1)+'%';document.getElementById('sSpy').className='stat-value '+(c>=0?'up':'down');document.getElementById('mSpy').textContent='$'+p.toFixed(0);document.getElementById('cSpy').textContent=(c>=0?'+':'')+c.toFixed(1)+'%';document.getElementById('cSpy').className='mkt-chg '+(c>=0?'up':'down')}}}catch(e){}}
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeModal()});
loadPrices();setInterval(loadPrices,60000);
</script>
</body>
</html>
<script>
// Plaid Link Integration
async function connectBrokerage() {
  try {
    const token = localStorage.getItem('eluxraj_token');
    const res = await fetch('/api/plaid/create-link-token', {
      method: 'POST',
      headers: { 'Authorization': 'Bearer ' + token }
    });
    const data = await res.json();
    
    if (!data.ok) {
      alert('Error: ' + data.error);
      return;
    }
    
    const handler = Plaid.create({
      token: data.link_token,
      onSuccess: async (public_token, metadata) => {
        await fetch('/api/plaid/exchange-token', {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer ' + token,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            public_token: public_token,
            institution: metadata.institution
          })
        });
        alert('Account connected! Loading holdings...');
        loadHoldings();
      },
      onExit: (err) => {
        if (err) console.error('Plaid error:', err);
      }
    });
    handler.open();
  } catch (e) {
    alert('Connection error: ' + e.message);
  }
}

async function loadHoldings() {
  const token = localStorage.getItem('eluxraj_token');
  const res = await fetch('/api/plaid/holdings', {
    headers: { 'Authorization': 'Bearer ' + token }
  });
  const data = await res.json();
  
  if (data.ok && data.holdings.length > 0) {
    let html = '<h3 style="color:var(--accent);margin-bottom:15px">Your Portfolio: $' + data.totalValue.toLocaleString() + '</h3>';
    html += '<div style="max-height:300px;overflow-y:auto">';
    data.holdings.forEach(h => {
      const color = h.gain >= 0 ? 'var(--green)' : 'var(--red)';
      html += '<div style="display:flex;justify-content:space-between;padding:10px;border-bottom:1px solid var(--border)">';
      html += '<div><strong>' + h.symbol + '</strong><br><span style="font-size:12px;color:var(--muted)">' + h.name.substring(0,25) + '</span></div>';
      html += '<div style="text-align:right"><strong>$' + h.value.toLocaleString() + '</strong><br><span style="color:' + color + '">' + (h.gain >= 0 ? '+' : '') + h.gainPercent.toFixed(1) + '%</span></div>';
      html += '</div>';
    });
    html += '</div>';
    document.getElementById('holdingsArea').innerHTML = html;
    document.getElementById('holdingsArea').style.display = 'block';
  }
}

// Load holdings on page load
document.addEventListener('DOMContentLoaded', loadHoldings);
</script>
