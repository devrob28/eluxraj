
<!-- Price Alert Modal -->
<div id="alertModal" class="modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:1000;align-items:center;justify-content:center;">
    <div class="modal-content" style="background:#1a1a2e;border-radius:16px;padding:24px;max-width:400px;width:90%;margin:auto;position:relative;top:50%;transform:translateY(-50%);">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
            <h2 style="color:#fff;margin:0;">ðŸ”” Set Price Alert</h2>
            <button onclick="closeAlertModal()" style="background:none;border:none;color:#888;font-size:24px;cursor:pointer;">&times;</button>
        </div>
        <div style="margin-bottom:16px;">
            <label style="color:#888;font-size:12px;display:block;margin-bottom:6px;">Asset</label>
            <select id="alertAsset" style="width:100%;padding:12px;background:#0d0d1a;border:1px solid #333;border-radius:8px;color:#fff;font-size:16px;">
                <option value="BTC">BTC - Bitcoin</option>
                <option value="ETH">ETH - Ethereum</option>
                <option value="SOL">SOL - Solana</option>
                <option value="XRP">XRP - Ripple</option>
                <option value="DOGE">DOGE - Dogecoin</option>
                <option value="AAPL">AAPL - Apple</option>
                <option value="TSLA">TSLA - Tesla</option>
                <option value="NVDA">NVDA - Nvidia</option>
            </select>
        </div>
        <div style="margin-bottom:16px;">
            <label style="color:#888;font-size:12px;display:block;margin-bottom:6px;">Alert Type</label>
            <select id="alertType" style="width:100%;padding:12px;background:#0d0d1a;border:1px solid #333;border-radius:8px;color:#fff;font-size:16px;">
                <option value="price">Price</option>
                <option value="oracle_score">ORACLE Score</option>
            </select>
        </div>
        <div style="margin-bottom:16px;">
            <label style="color:#888;font-size:12px;display:block;margin-bottom:6px;">Condition</label>
            <select id="alertCondition" style="width:100%;padding:12px;background:#0d0d1a;border:1px solid #333;border-radius:8px;color:#fff;font-size:16px;">
                <option value="above">Goes Above</option>
                <option value="below">Goes Below</option>
            </select>
        </div>
        <div style="margin-bottom:20px;">
            <label style="color:#888;font-size:12px;display:block;margin-bottom:6px;">Threshold</label>
            <input type="number" id="alertThreshold" placeholder="e.g. 100000" style="width:100%;padding:12px;background:#0d0d1a;border:1px solid #333;border-radius:8px;color:#fff;font-size:16px;box-sizing:border-box;">
        </div>
        <button onclick="createAlert()" style="width:100%;padding:14px;background:linear-gradient(135deg,#00d4aa,#00a080);border:none;border-radius:8px;color:#fff;font-size:16px;font-weight:600;cursor:pointer;">Create Alert</button>
        <div id="alertMessage" style="margin-top:12px;text-align:center;font-size:14px;"></div>
    </div>
</div>

<script>
function openAlertModal(){document.getElementById('alertModal').style.display='flex';}
function closeAlertModal(){document.getElementById('alertModal').style.display='none';document.getElementById('alertMessage').textContent='';}
async function createAlert(){
    const asset=document.getElementById('alertAsset').value;
    const type=document.getElementById('alertType').value;
    const condition=document.getElementById('alertCondition').value;
    const threshold=parseFloat(document.getElementById('alertThreshold').value);
    const msg=document.getElementById('alertMessage');
    if(!threshold){msg.style.color='#ff6b6b';msg.textContent='Please enter a threshold';return;}
    try{
        const res=await fetch(API+'/alerts/rules',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify({name:asset+' '+type+' '+condition+' '+threshold,asset:asset,asset_type:['BTC','ETH','SOL','XRP','DOGE'].includes(asset)?'crypto':'stock',trigger_type:type,condition:condition,threshold:threshold})});
        const data=await res.json();
        if(data.ok){msg.style.color='#00d4aa';msg.textContent='âœ“ Alert created!';setTimeout(closeAlertModal,1500);}
        else{msg.style.color='#ff6b6b';msg.textContent=data.detail||'Failed to create alert';}
    }catch(e){msg.style.color='#ff6b6b';msg.textContent='Error creating alert';}
}
document.getElementById('alertModal').addEventListener('click',function(e){if(e.target===this)closeAlertModal();});
</script>
</body>
</html>
